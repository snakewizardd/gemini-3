<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Epoch of Entropy: 2020-2025</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Syncopate:wght@400;700&family=Rajdhani:wght@300;500&display=swap');

        body {
            margin: 0;
            background: #000;
            overflow: hidden;
            font-family: 'Rajdhani', sans-serif;
            color: #fff;
        }

        #canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1;
        }

        #overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            cursor: pointer;
            transition: opacity 2s ease;
        }

        #ui {
            position: absolute;
            z-index: 10;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            pointer-events: none;
            width: 100%;
        }

        #year-display {
            font-family: 'Syncopate', sans-serif;
            font-weight: 700;
            font-size: 8vw;
            letter-spacing: -5px;
            opacity: 0;
            transition: opacity 1s, color 2s;
            text-shadow: 0 0 30px currentColor;
        }

        #era-name {
            font-size: 1.5rem;
            letter-spacing: 10px;
            text-transform: uppercase;
            opacity: 0;
            margin-top: -20px;
            transition: opacity 1s;
        }

        .glitch { animation: glitch 0.2s infinite; }
        @keyframes glitch {
            0% { transform: translate(0,0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(2px, -2px); }
            100% { transform: translate(0,0); }
        }
        
        #entropy-meter {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 2px;
            background: #333;
            z-index: 10;
        }
        #entropy-fill {
            width: 0%;
            height: 100%;
            background: #fff;
            transition: width 0.1s;
            box-shadow: 0 0 10px #fff;
        }

    </style>
</head>
<body>

    <canvas id="canvas"></canvas>

    <div id="ui">
        <div id="year-display">2020</div>
        <div id="era-name">THE GREAT SILENCE</div>
    </div>
    
    <div id="entropy-meter"><div id="entropy-fill"></div></div>

    <div id="overlay">
        <h1 style="font-family: 'Syncopate'; letter-spacing: 5px;">THE EPOCH OF ENTROPY</h1>
        <p style="color: #666;">[ A PROCEDURAL REENACTMENT OF 2020-2025 ]</p>
    </div>

<script>
/**
 * THE TIMELINE CONFIGURATION
 * Defines the Physics, Audio, and Visual rules for each historical era.
 */
const TIMELINE = [
    {
        year: 2020,
        title: "THE GREAT SILENCE",
        color: "#4A90E2", // Cold Blue
        scale: [146.83, 174.61, 220.00, 261.63], // Minor/Empty
        audioMode: 'ISOLATION', // Sine waves, huge reverb, sparse
        chaos: 0.05, // Low movement
        collatzBias: 0.2, // Heavily biased towards n/2 (Lockdown/Contraction)
        particleBehavior: 'FREEZE'
    },
    {
        year: 2021,
        title: "THE FEVER",
        color: "#FF4136", // Fever Red
        scale: [146.83, 155.56, 185.00, 220.00, 233.08], // Phrygian Dominant (Tension)
        audioMode: 'PANIC', // Sawtooth, FM synthesis, erratic rhythm
        chaos: 0.9, // High velocity
        collatzBias: 0.8, // Biased towards 3n+1 (Spikes/Infection)
        particleBehavior: 'EXPLODE'
    },
    {
        year: 2022,
        title: "THE GRIND",
        color: "#FF851B", // Rust/War
        scale: [73.42, 110.00, 123.47, 146.83], // Low Heavy Drones
        audioMode: 'DISTORTION', // Gritty, slow, heavy bass
        chaos: 0.5,
        collatzBias: 0.5, // Stuck in loops
        particleBehavior: 'GRAVITY'
    },
    {
        year: 2023,
        title: "THE HOLLOW",
        color: "#AAAAAA", // Grey/Inflation
        scale: [146.83, 196.00, 220.00, 293.66], // Unresolved Sus chords
        audioMode: 'DISSONANCE', // Detuned oscillators
        chaos: 0.3,
        collatzBias: 0.4,
        particleBehavior: 'DRIFT'
    },
    {
        year: 2024,
        title: "THE ACCELERATION",
        color: "#FFFFFF", // AI White
        scale: [293.66, 369.99, 440.00, 587.33, 739.99], // Lydian/Sparkle
        audioMode: 'FUTURE', // Additive synthesis, arpeggios
        chaos: 1.0, // Max speed
        collatzBias: 0.9, // Infinite growth
        particleBehavior: 'HYPER'
    }
];

let currentEraIndex = 0;
let ERA = TIMELINE[0];

/**
 * AUDIO ENGINE: THE GLOBAL STAGE
 */
const AudioContext = window.AudioContext || window.webkitAudioContext;
let ctx, master, reverb, limiter, distortion;

function initAudio() {
    ctx = new AudioContext();
    master = ctx.createGain();
    master.gain.value = 0.4;

    // LIMITER (Safety for the chaos years)
    limiter = ctx.createDynamicsCompressor();
    limiter.threshold.value = -10;
    limiter.ratio.value = 20;

    // GLOBAL DISTORTION (For 2022)
    distortion = ctx.createWaveShaper();
    distortion.curve = makeDistortionCurve(0); // Start clean
    distortion.oversample = '4x';

    // THE WORLD REVERB
    reverb = ctx.createConvolver();
    reverb.buffer = createImpulse(5, 2);

    // Chain
    master.connect(distortion);
    distortion.connect(limiter);
    limiter.connect(ctx.destination);
    limiter.connect(reverb);
    reverb.connect(ctx.destination);
    
    // Start the sequence
    progressTimeline();
}

function makeDistortionCurve(amount) {
    const k = typeof amount === 'number' ? amount : 50,
        n_samples = 44100,
        curve = new Float32Array(n_samples),
        deg = Math.PI / 180;
    for (let i = 0; i < n_samples; ++i) {
        const x = i * 2 / n_samples - 1;
        curve[i] = (3 + k) * x * 20 * deg / (Math.PI + k * Math.abs(x));
    }
    return curve;
}

function createImpulse(dur, decay) {
    const L = ctx.sampleRate * dur;
    const b = ctx.createBuffer(2, L, ctx.sampleRate);
    for(let i=0; i<L; i++) {
        const k = Math.pow(1-i/L, decay);
        b.getChannelData(0)[i] = (Math.random()*2-1)*k;
        b.getChannelData(1)[i] = (Math.random()*2-1)*k;
    }
    return b;
}

/**
 * THE COLLATZ SYNTHESIZER
 * Generates sound based on the mathematical step and the Era's rules.
 */
function playCollatzTone(val, era) {
    const t = ctx.currentTime;
    const osc = ctx.createOscillator();
    const mod = ctx.createOscillator();
    const gain = ctx.createGain();
    const pan = ctx.createStereoPanner();

    // PITCH LOGIC
    const noteIdx = val % era.scale.length;
    const baseFreq = era.scale[noteIdx];
    const octave = Math.floor(Math.log2(val));
    let freq = baseFreq * (1 + (octave * 0.5));
    
    // Cap freq
    if (freq > 2000) freq = freq / 4;

    // ERA SPECIFIC SOUND DESIGN
    if (era.audioMode === 'ISOLATION') {
        osc.type = 'sine';
        gain.gain.value = 0.3;
        // Long attack, long release (Ambient)
        gain.gain.setValueAtTime(0, t);
        gain.gain.linearRampToValueAtTime(0.2, t + 0.5);
        gain.gain.exponentialRampToValueAtTime(0.001, t + 3);
    } 
    else if (era.audioMode === 'PANIC') {
        osc.type = 'sawtooth';
        // FM Synthesis for anxiety
        mod.frequency.value = freq * 1.45; // Dissonant ratio
        const mGain = ctx.createGain();
        mGain.gain.value = 500;
        mod.connect(mGain);
        mGain.connect(osc.frequency);
        mod.start(t);
        
        gain.gain.setValueAtTime(0.1, t);
        gain.gain.exponentialRampToValueAtTime(0.001, t + 0.3); // Short, sharp
    }
    else if (era.audioMode === 'DISTORTION') {
        osc.type = 'square';
        freq = freq / 2; // Drop octave
        osc.detune.value = Math.random() * 50; // Detuned/Sick
        gain.gain.setValueAtTime(0.2, t);
        gain.gain.linearRampToValueAtTime(0, t + 1);
    }
    else if (era.audioMode === 'FUTURE') {
        osc.type = 'sine'; // Crystal clear
        // Arpeggiated feel handled by rapid firing elsewhere
        gain.gain.setValueAtTime(0, t);
        gain.gain.linearRampToValueAtTime(0.1, t + 0.05);
        gain.gain.exponentialRampToValueAtTime(0.001, t + 1.5);
    }
    else { // Dissonance
        osc.type = 'triangle';
        osc.detune.value = 100; // Microtonal shifting
        gain.gain.setValueAtTime(0.1, t);
        gain.gain.exponentialRampToValueAtTime(0.001, t + 2);
    }

    osc.frequency.value = freq;
    osc.connect(gain);
    gain.connect(pan);
    
    // Random Pan
    pan.pan.value = Math.random() * 2 - 1;
    pan.connect(master);

    osc.start(t);
    osc.stop(t + 4);
}


/**
 * THE SIMULATION LOOP
 */
const PARTICLES = [];

function progressTimeline() {
    if (currentEraIndex >= TIMELINE.length) return; // End of history
    
    ERA = TIMELINE[currentEraIndex];
    
    // Update UI
    const yearEl = document.getElementById('year-display');
    const nameEl = document.getElementById('era-name');
    
    yearEl.style.opacity = 0;
    nameEl.style.opacity = 0;
    
    setTimeout(() => {
        yearEl.innerText = ERA.year;
        yearEl.style.color = ERA.color;
        yearEl.style.opacity = 1;
        
        nameEl.innerText = ERA.title;
        nameEl.style.opacity = 1;
        
        // Play Era Transition Sound (Impact)
        playEraBoom();
        
        // Apply Global Effects
        if (ERA.audioMode === 'DISTORTION') distortion.curve = makeDistortionCurve(400);
        else distortion.curve = makeDistortionCurve(0);

    }, 1000);

    // Schedule next era
    currentEraIndex++;
    if (currentEraIndex < TIMELINE.length) {
        setTimeout(progressTimeline, 8000); // 8 Seconds per year
    }
}

function playEraBoom() {
    const t = ctx.currentTime;
    const osc = ctx.createOscillator();
    const g = ctx.createGain();
    osc.frequency.value = 50;
    osc.frequency.exponentialRampToValueAtTime(10, t + 2);
    g.gain.setValueAtTime(1, t);
    g.gain.exponentialRampToValueAtTime(0.001, t + 4);
    osc.connect(g);
    g.connect(master);
    osc.start(t);
    osc.stop(t + 4);
}

// SPAWN ENTITIES
setInterval(() => {
    if (!ctx) return;
    // Spawn rate depends on chaos
    const spawnChance = ERA.chaos * 0.5; 
    if (Math.random() < spawnChance + 0.1) {
        PARTICLES.push({
            n: Math.floor(Math.random() * 50) + 5,
            x: window.innerWidth / 2,
            y: window.innerHeight / 2,
            vx: (Math.random() - 0.5) * 2,
            vy: (Math.random() - 0.5) * 2,
            life: 1
        });
    }
}, 50);

// PHYSICS LOOP
setInterval(() => {
    if (!ctx) return;
    
    // Entropy Meter
    const chaosLevel = PARTICLES.length * 2;
    document.getElementById('entropy-fill').style.width = Math.min(100, chaosLevel) + "%";
    document.getElementById('entropy-fill').style.backgroundColor = ERA.color;

    PARTICLES.forEach((p, i) => {
        // Play Sound on Beat
        if (Math.random() < 0.05) playCollatzTone(p.n, ERA);

        // Collatz Step based on History Bias
        // In 2020/Descension years, force n/2 more often
        // In 2021/Ascension years, force 3n+1 more often
        const roll = Math.random();
        
        if (p.n === 1) {
            // Loop
            p.n = Math.floor(Math.random() * 100) + 10;
        } else if (p.n % 2 === 0) {
             // Even: Divide
             p.n = p.n / 2;
        } else {
            // Odd: Multiply
            // SIMULATE CRISIS: If bias is high, prevent resolution
            if (roll < ERA.collatzBias) {
                p.n = (p.n * 3) + 1;
            } else {
                // Artificial resolution mechanism (Government intervention?)
                p.n = Math.floor(p.n / 2); 
            }
        }
        
        // Kill old particles
        p.life -= 0.01;
        if (p.life <= 0) PARTICLES.splice(i, 1);
    });

}, 150); // Rhythm Tick


/**
 * VISUAL RENDERER
 */
const canvas = document.getElementById('canvas');
const c = canvas.getContext('2d');
let w, h;

function resize() { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; }
window.addEventListener('resize', resize);
resize();

function draw() {
    // Trail effect varies by era
    const alpha = ERA.year === 2024 ? 0.1 : 0.2;
    c.fillStyle = `rgba(0, 0, 0, ${alpha})`;
    c.fillRect(0, 0, w, h);

    const cx = w/2;
    const cy = h/2;

    // Shake screen during Chaos years
    c.save();
    if (ERA.chaos > 0.6) {
        const shake = (Math.random() - 0.5) * 5;
        c.translate(shake, shake);
    }

    PARTICLES.forEach(p => {
        // Visual behavior based on era
        if (ERA.particleBehavior === 'FREEZE') {
            // 2020: Stuck in place, vibrating
            p.x = cx + (Math.random()-0.5)*10;
            p.y = cy + (Math.random()-0.5)*10;
        } 
        else if (ERA.particleBehavior === 'EXPLODE') {
            // 2021: Shooting out
            p.x += p.vx * 10;
            p.y += p.vy * 10;
        }
        else if (ERA.particleBehavior === 'GRAVITY') {
            // 2022: Falling down
            p.y += 2;
            p.x += (Math.random()-0.5);
        }
        else if (ERA.particleBehavior === 'HYPER') {
            // 2024: Fast Orbit
            const ang = Date.now() * 0.005;
            const r = 200 + Math.sin(Date.now()*0.01)*100;
            p.x = cx + Math.cos(ang + p.n) * r;
            p.y = cy + Math.sin(ang + p.n) * r;
        }
        else {
            // 2023: Drift
            p.x += p.vx;
            p.y += p.vy;
        }

        // Draw
        const size = Math.log(p.n) * 2;
        c.beginPath();
        c.arc(p.x, p.y, size, 0, Math.PI*2);
        c.fillStyle = ERA.color;
        
        // Glow
        c.shadowBlur = ERA.year === 2024 ? 30 : 10;
        c.shadowColor = ERA.color;
        c.fill();
        c.shadowBlur = 0;
        
        // Connecting lines in 2020/2024
        if (ERA.year === 2020 || ERA.year === 2024) {
            c.strokeStyle = `rgba(255,255,255,0.1)`;
            c.beginPath();
            c.moveTo(cx, cy);
            c.lineTo(p.x, p.y);
            c.stroke();
        }
    });

    c.restore();
    requestAnimationFrame(draw);
}

// INIT
document.getElementById('overlay').addEventListener('click', () => {
    const o = document.getElementById('overlay');
    o.style.opacity = 0;
    setTimeout(() => o.remove(), 2000);
    initAudio();
    draw();
});

</script>
</body>
</html>