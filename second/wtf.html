<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ONYX // VECTOR HARVEST</title>
<style>
:root { --acc: #00f3ff; --bg: #080808; --w: #eee; --d: #111; }
body {
margin: 0; background: var(--bg); overflow: hidden;
font-family: 'Consolas', 'Monaco', monospace; color: var(--w);
height: 100vh; width: 100vw;
}
canvas { position: absolute; top: 0; left: 0; z-index: 0; mix-blend-mode: screen; }
code
Code
#ui-grid {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    z-index: 10; pointer-events: none;
    background: linear-gradient(transparent 95%, rgba(0, 243, 255, 0.1) 100%),
                linear-gradient(90deg, transparent 95%, rgba(0, 243, 255, 0.1) 100%);
    background-size: 40px 40px;
}

#main {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    text-align: center; z-index: 20; pointer-events: auto;
}

h1 { 
    font-size: 4rem; letter-spacing: -2px; margin: 0; color: var(--w); 
    text-shadow: 0 0 20px var(--acc); font-weight: 400;
}

#btn-init {
    background: transparent; color: var(--acc); border: 2px solid var(--acc);
    padding: 15px 60px; font-size: 1rem; font-family: inherit; 
    margin-top: 30px; cursor: pointer; text-transform: uppercase; letter-spacing: 4px;
    transition: 0.3s;
}
#btn-init:hover { background: var(--acc); color: #000; box-shadow: 0 0 30px var(--acc); }

.monitor {
    position: absolute; font-size: 10px; color: var(--acc); opacity: 0.7;
}
#top-left { top: 30px; left: 30px; text-align: left; }
#btm-right { bottom: 30px; right: 30px; text-align: right; }

.active-state #main { opacity: 0; pointer-events: none; }
.active-state #play-info { opacity: 1; }

#play-info {
    position: absolute; bottom: 50px; left: 0; width: 100%; 
    text-align: center; opacity: 0; transition: 0.5s; z-index: 20;
}
.p-bar { width: 300px; height: 4px; background: #222; display: inline-block; margin-top: 10px; position: relative; }
.p-fill { width: 0%; height: 100%; background: var(--acc); transition: width 0.2s linear; box-shadow: 0 0 10px var(--acc);}
</style>
</head>
<body>
<div id="ui-grid"></div>
<div id="top-left">
SYSTEM: ONYX AUDIOGRID<br>
COMPOSER: A.I. LOGIC<br>
STATUS: IDLE
</div>
<div id="btm-right">
FREQ: 44.1KHZ<br>
LATENCY: 2ms<br>
RENDER: WEBGL
</div>
<div id="main">
<h1>VECTOR HARVEST</h1>
<button id="btn-init">INITIALIZE PROTOCOL</button>
</div>
<div id="play-info">
<div id="seq-step">WAITING</div>
<div class="p-bar"><div class="p-fill" id="p-fill"></div></div>
</div>
<canvas id="c"></canvas>
<script>
/*
COMPOSITION: VECTOR HARVEST
GENRE: Techstep / Neurofunk
BPM: 172
KEY: D Minor
*/

const ctx = document.getElementById('c').getContext('2d');
let w, h;

// AUDIO CONTEXT
let ac, master, limiter, delay, verb;
let isRunning = false;
let startTime = 0;

// CONSTANTS
const BPM = 172;
const BEAT = 60 / BPM;
const BAR = BEAT * 4;
const T_SIX = BEAT / 4;

// SCALE (D Minor)
const MIDI = n => 440 * Math.pow(2, (n - 69) / 12);
// D1, F1, G1, A1, D2, F2, A2, D3
const NOTES = {
D1: MIDI(38), F1: MIDI(41), G1: MIDI(43), A1: MIDI(45),
Bb1: MIDI(46), D2: MIDI(50), F2: MIDI(53), A2: MIDI(57),
C3: MIDI(60), D3: MIDI(62), E3: MIDI(64), F3: MIDI(65), A3: MIDI(69)
};

// ==================== AUDIO ENGINE ==================== //

async function initAudio() {
const AC = window.AudioContext || window.webkitAudioContext;
ac = new AC();
await ac.resume();

// Master Chain
master = ac.createGain();
master.gain.value = 0.7;

// Hard Limiter
limiter = ac.createDynamicsCompressor();
limiter.threshold.value = -2;
limiter.ratio.value = 20;
limiter.attack.value = 0.001;

// Aux Effects (Stereo Ping Pong Delay)
delay = createDelay();

// Reverb (Convolver)
verb = await createReverb();

master.connect(limiter).connect(ac.destination);
}

// AUX FX GENERATORS
function createDelay() {
const dL = ac.createDelay(); dL.delayTime.value = BEAT * 0.75; // Dotted 8th
const dR = ac.createDelay(); dR.delayTime.value = BEAT * 0.5; // 8th
const fb = ac.createGain(); fb.gain.value = 0.4;
const merger = ac.createChannelMerger(2);
const input = ac.createGain();

input.connect(dL); input.connect(dR);
dL.connect(merger, 0, 0); dR.connect(merger, 0, 1);
dL.connect(fb); dR.connect(fb); fb.connect(input);
merger.connect(master);
return input;
}

async function createReverb() {
// Synthesize a metallic impulse
const len = ac.sampleRate * 1.5;
const buf = ac.createBuffer(2, len, ac.sampleRate);
for(let c=0;c<2;c++){
const ch = buf.getChannelData(c);
for(let i=0;i<len;i++) ch[i] = (Math.random()*2-1) * Math.exp(-i/(len/10));
}
const con = ac.createConvolver(); con.buffer = buf;
const inG = ac.createGain(); const outG = ac.createGain(); outG.gain.value = 0.2;
inG.connect(con).connect(outG).connect(master);
return inG;
}

// === INSTRUMENTS === //

// 1. THE GROWL (FM Synthesis Bass)
function bassFM(t, note, dur, modIdx = 5, articulate = true) {
const c = ac.createOscillator(); // Carrier
const m = ac.createOscillator(); // Modulator
const mG = ac.createGain(); // Mod Amplitude
const m2 = ac.createOscillator(); // Sub Mod

// Setup Frequencies
c.frequency.value = note;
c.type = 'sine';

// Ratio 1:2 for harsh octave harmonic, slightly detuned
m.frequency.value = note * 2 + (Math.random()*2);
m.type = 'sawtooth';

m2.frequency.value = 6; // LFO Speed
const lfoG = ac.createGain();
lfoG.gain.value = 10;

// Envelope
const g = ac.createGain();
g.gain.setValueAtTime(0, t);

if (articulate) {
// Wah shape
g.gain.linearRampToValueAtTime(1, t + 0.05);
g.gain.exponentialRampToValueAtTime(0.01, t + dur);
// Mod Index sweep (The "Yoi" sound)
mG.gain.setValueAtTime(0, t);
mG.gain.linearRampToValueAtTime(note * modIdx, t + (dur*0.3));
mG.gain.linearRampToValueAtTime(0, t + dur);
} else {
// Sustain drone
g.gain.linearRampToValueAtTime(0.8, t+0.1);
g.gain.linearRampToValueAtTime(0, t+dur);
mG.gain.value = note * 2;
}

// Distort Chain
const shaper = ac.createWaveShaper();
shaper.curve = new Float32Array(44100).map((_,i) => {
const x = (i/44100)*2-1;
return Math.tanh(x*5); // Soft clip
});

// Routing
m.connect(mG).connect(c.frequency);
c.connect(shaper).connect(g).connect(master);

c.start(t); c.stop(t + dur);
m.start(t); m.stop(t + dur);

viz.kick = 0.5; // shake screen on bass too
}

// 2. CYBER KICK (Pitch envelope pulse)
function kick(t) {
const o = ac.createOscillator();
const g = ac.createGain();
o.frequency.setValueAtTime(180, t);
o.frequency.exponentialRampToValueAtTime(45, t + 0.1);

g.gain.setValueAtTime(1.5, t);
g.gain.exponentialRampToValueAtTime(0.01, t + 0.25);

o.connect(g).connect(limiter); // Bypass master vol for punch
o.start(t); o.stop(t + 0.25);

viz.kick = 1.0;
}

// 3. TEK SNARE (Noise + Fundamental)
function snare(t) {
const n = ac.createBufferSource();
n.buffer = ((() => {
const b = ac.createBuffer(1, 44100 * 0.2, 44100);
const d = b.getChannelData(0);
for(let i=0; i<d.length; i++) d[i] = Math.random() * 2 - 1;
return b;
})());

const tri = ac.createOscillator(); tri.type = 'triangle';
tri.frequency.setValueAtTime(220, t);
tri.frequency.linearRampToValueAtTime(100, t+0.1);

const nG = ac.createGain(); nG.gain.setValueAtTime(1, t); nG.gain.exponentialRampToValueAtTime(0.01, t+0.15);
const tG = ac.createGain(); tG.gain.setValueAtTime(0.8, t); tG.gain.exponentialRampToValueAtTime(0.01, t+0.1);

// Bandpass filter to make noise snap
const f = ac.createBiquadFilter(); f.type = 'bandpass'; f.frequency.value = 2000; f.Q.value = 1;

n.connect(f).connect(nG).connect(master);
n.connect(f).connect(nG).connect(verb); // Reverb send
tri.connect(tG).connect(master);

n.start(t); tri.start(t); tri.stop(t+0.15);

viz.snare = 1.0;
}

// 4. HAT (Metallic Highpass)
function hat(t, open = false) {
const len = open ? 0.3 : 0.05;
const n = ac.createOscillator(); // FM Hat
n.type = 'square';
const n2 = ac.createOscillator(); n2.type='square'; n2.frequency.value=8400;
n2.connect(n.frequency);

const f = ac.createBiquadFilter(); f.type='highpass'; f.frequency.value=6000;
const g = ac.createGain();
g.gain.setValueAtTime(open?0.1:0.15, t);
g.gain.exponentialRampToValueAtTime(0.001, t+len);

n.connect(f).connect(g).connect(master);
n.start(t); n2.start(t);
n.stop(t+len); n2.stop(t+len);
}

// 5. PLUCK (Arpeggiator sound)
function pluck(t, note) {
const o = ac.createOscillator(); o.type='sawtooth'; o.frequency.value = note;
const f = ac.createBiquadFilter(); f.type='lowpass';

f.frequency.setValueAtTime(note, t);
f.frequency.exponentialRampToValueAtTime(note * 4, t + 0.01); // pluck attack
f.frequency.exponentialRampToValueAtTime(note, t + 0.2);

const g = ac.createGain(); g.gain.value=0.15; g.gain.exponentialRampToValueAtTime(0.001, t+0.4);

o.connect(f).connect(g).connect(master);
g.connect(delay); // Send to delay

o.start(t); o.stop(t+0.4);
}

// ==================== COMPOSITION / SEQUENCER ==================== //

let nextT = 0;
let step = 0;
const TOTAL_STEPS = 16 * 64; // 64 Bars

function scheduler() {
if (!isRunning) return;

const lookahead = 0.1;
while (nextT < ac.currentTime + lookahead) {
runPattern(step, nextT);
nextT += T_SIX;
step++;
if(step >= TOTAL_STEPS) {
isRunning = false;
finish();
}
}
requestAnimationFrame(scheduler);
}

function runPattern(s, t) {
const bar = Math.floor(s / 16);
const bStep = s % 16;

updateUI(bar, s);

// === STRUCTURE ===
// 0-8: INTRO (Arps)
// 8-16: DRUMS ENTER
// 16-24: BUILD (Filter Riser)
// 24-40: DROP 1 (Main Neuro Theme)
// 40-48: BREAKDOWN (Atmospheric)
// 48-64: DROP 2 (Max Chaos)

const isIntro = bar < 16;
const isBuild = bar >= 16 && bar < 24;
const isDrop = (bar >= 24 && bar < 40) || bar >= 48;
const isBreak = bar >= 40 && bar < 48;

// --- ARPEGGIATOR ---
if ((isIntro || isBreak) && bStep % 2 === 0) {
// Simple Dm pattern ascending
const notes = [NOTES.D3, NOTES.F3, NOTES.A3, NOTES.D2];
const idx = (bStep / 2) % 4;
pluck(t, notes[idx]);
if (bar >= 4 && Math.random()>0.8) pluck(t, NOTES.A2); // harmonizing rand
}
if (isDrop && bStep % 4 === 0 && Math.random() > 0.5) {
// Random glissando artifacts in drop
pluck(t, NOTES.E3);
}

// --- DRUMS (Standard DnB: Kick on 0, Snare on 4 & 12? No, standard is Snare on 4 & 12)
// Note: In 16th steps:
// Beat: 1...2...3...4...
// Step: 0...4...8...12..
// Two Step Pattern: Kick(0), Snare(8). Wait...
// BPM is 172. Step is 1/16.
// Standard Two Step: Kick on 0, Snare on 8. (With ghost notes)

const drumsActive = (bar >= 8 && !isBreak) || (bar >= 16);

if (drumsActive) {
// KICK
if (bStep === 0) kick(t);
if (bStep === 10 && (bar % 2 === 0)) kick(t); // The "Skippy" Kick
if (isDrop && bStep === 7) kick(t); // Aggressive neuro kick pattern

// SNARE
if (bStep === 8) snare(t);

// BUILD SNARE
if (isBuild && bar >= 22) {
if(bStep % 2 === 0) snare(t); // roll
}

// HATS
if (bStep % 2 === 0) hat(t);
if (bStep % 4 === 2) hat(t, true); // open hat offbeat
}

// --- BASS ---
if (isDrop) {
// PATTERN A: The "Call"
if (bar % 4 === 0) {
if (bStep === 0) bassFM(t, NOTES.D1, BEAT * 1.5, 4);
if (bStep === 11) bassFM(t, NOTES.F1, BEAT * 0.5, 8); // flick
}
// PATTERN B: The "Response"
else if (bar % 4 === 1) {
if (bStep === 0) bassFM(t, NOTES.C3, BEAT, 10); // high pitch growl
if (bStep === 4) bassFM(t, NOTES.D1, BEAT, 2);
}
// PATTERN C: Rolling
else {
if (bStep === 0) bassFM(t, NOTES.D1, BEAT * 2, 5, false);
if (bStep === 12) bassFM(t, NOTES.G1, BEAT, 15); // womp
}
} else if (isBuild) {
// Rising tension bass
if (bStep === 0 && bar % 2 === 0) bassFM(t, NOTES.D1, BEAT * 4, 2, false);
} else if (bar >= 4 && bar < 8) {
// Intro subs
if (bStep === 0) bassFM(t, NOTES.D1, BEAT*4, 1, false);
}
}

function updateUI(bar, s) {
document.getElementById('p-fill').style.width = (s/TOTAL_STEPS*100) + '%';

let stateText = "INTRO // UPLINK";
if (bar >= 16) stateText = "SEQUENCE // ACCEL";
if (bar >= 24) stateText = ">>> CORE DUMP <<<";
if (bar >= 40) stateText = "SYSTEM IDLE";
if (bar >= 48) stateText = "CRITICAL FAILURE";

document.getElementById('seq-step').innerText = `${stateText} [BAR ${bar+1}]`;
}

function finish() {
document.getElementById('main').style.opacity = 1;
document.querySelector('h1').innerText = "SEQUENCE COMPLETE";
document.getElementById('btn-init').style.display = 'inline-block';
document.getElementById('btn-init').innerText = "RESTART";
document.body.classList.remove('active-state');
}

// ==================== VISUALS ==================== //

let viz = { kick: 0, snare: 0 };

function initViz() {
w = document.getElementById('c').width = window.innerWidth;
h = document.getElementById('c').height = window.innerHeight;
}
window.onresize = initViz;

function draw() {
requestAnimationFrame(draw);

// Decay triggers
viz.kick *= 0.9;
viz.snare *= 0.9;

// BG clearing (Trail effect)
ctx.fillStyle = 'rgba(8,8,8,0.2)';
ctx.fillRect(0, 0, w, h);

const cx = w/2;
const cy = h/2;

// Shake
const dx = (Math.random()-0.5) * viz.kick * 20;
const dy = (Math.random()-0.5) * viz.kick * 20;

ctx.save();
ctx.translate(dx, dy);

// Central Pulse (Snare)
if (viz.snare > 0.01) {
ctx.beginPath();
ctx.arc(cx, cy, viz.snare * 200, 0, Math.PI*2);
ctx.strokeStyle = `rgba(255, 255, 255, ${viz.snare})`;
ctx.lineWidth = 2;
ctx.stroke();
}

// Grid lines reacting to bass
ctx.beginPath();
const lines = 12;
for (let i=0; i<lines; i++) {
const angle = (i/lines) * Math.PI*2;
const len = 100 + (viz.kick * 150);
const x1 = cx + Math.cos(angle) * 50;
const y1 = cy + Math.sin(angle) * 50;
const x2 = cx + Math.cos(angle) * len;
const y2 = cy + Math.sin(angle) * len;

ctx.strokeStyle = i%2===0 ? '#00f3ff' : '#ff0055';
ctx.lineWidth = 2 + (viz.kick * 4);
ctx.moveTo(x1, y1);
ctx.lineTo(x2, y2);
}
ctx.stroke();

// Rotating Ring
ctx.beginPath();
const r = 100 + (viz.kick * 20);
ctx.arc(cx, cy, r, 0, Math.PI*2);
ctx.strokeStyle = 'rgba(0, 243, 255, 0.5)';
ctx.lineWidth = 4;
ctx.stroke();

ctx.restore();
}

// BOOTSTRAP
initViz();
draw();

document.getElementById('btn-init').addEventListener('click', async () => {
document.body.classList.add('active-state');
await initAudio();
startTime = ac.currentTime + 0.1;
nextT = startTime;
step = 0;
isRunning = true;
scheduler();
});

</script>
</body>
</html>