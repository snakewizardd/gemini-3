<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HARMONIC TIDE // DISTRIBUTION</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@300;700&display=swap');

        body {
            margin: 0;
            background-color: #051015; /* Deep Sea */
            overflow: hidden;
            font-family: 'Quicksand', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #aaffff;
        }

        canvas {
            position: absolute;
            top: 0; left: 0;
            z-index: 1;
        }

        #ui {
            position: absolute;
            z-index: 10;
            text-align: center;
            background: radial-gradient(circle, rgba(5, 16, 21, 0.9) 0%, rgba(5, 16, 21, 0.4) 100%);
            padding: 60px;
            border-radius: 50%;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 50px rgba(0, 255, 255, 0.1);
            transition: opacity 1s;
        }

        h1 {
            font-weight: 300;
            letter-spacing: 5px;
            margin-bottom: 10px;
            text-transform: uppercase;
            text-shadow: 0 0 20px #00ffff;
        }

        p {
            font-size: 0.8rem;
            letter-spacing: 2px;
            opacity: 0.7;
            margin-bottom: 30px;
        }

        button {
            pointer-events: auto;
            background: transparent;
            color: #aaffff;
            border: 1px solid #aaffff;
            padding: 15px 40px;
            font-size: 1rem;
            font-family: inherit;
            cursor: pointer;
            border-radius: 30px;
            transition: 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        button:hover {
            background: #aaffff;
            color: #051015;
            box-shadow: 0 0 30px #aaffff;
        }

        #readout {
            position: absolute;
            bottom: 20px;
            left: 20px;
            font-size: 12px;
            color: rgba(255,255,255,0.5);
            z-index: 5;
            line-height: 1.6;
            pointer-events: none;
            opacity: 0;
            transition: opacity 1s;
        }

    </style>
</head>
<body>

    <canvas id="world"></canvas>

    <div id="ui">
        <h1>HARMONIC TIDE</h1>
        <p>AUDITORY DISTRIBUTION ENGINE</p>
        <button id="btn-init">IMMERSE</button>
    </div>

    <div id="readout">
        OCEAN (BASS): <span id="val-ocean">0</span>%<br>
        WIND (ATMOS): <span id="val-wind">0</span>%<br>
        LIFE (HIGH): <span id="val-life">0</span>%
    </div>

    <script>
        const canvas = document.getElementById('world');
        const ctx = canvas.getContext('2d', { alpha: false });
        const readout = document.getElementById('readout');

        let width, height, cx, cy;
        let time = 0;
        let isRunning = false;
        
        // SIMULATION STATE
        let waveHeight = 0; // Driven by audio
        let birds = [];
        let sparkles = [];

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            cx = width / 2;
            cy = height / 2;
        }
        window.addEventListener('resize', resize);
        resize();

        /* ------------------------------------------------
           VISUAL ENGINE
           ------------------------------------------------ */
        
        class Bird {
            constructor() {
                this.reset();
            }
            reset() {
                this.x = -50;
                this.y = Math.random() * (height * 0.4);
                this.vx = 1 + Math.random();
                this.vy = (Math.random() - 0.5) * 0.5;
                this.wingSpeed = 0.1 + Math.random() * 0.1;
                this.size = 2 + Math.random() * 3;
            }
            update() {
                this.x += this.vx;
                this.y += this.vy + Math.sin(time) * 0.2;
                if (this.x > width + 50) this.reset();
            }
            draw() {
                ctx.beginPath();
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.6)';
                ctx.lineWidth = 1.5;
                
                // V shape flapping
                const flap = Math.sin(time * 10 * this.wingSpeed) * 5;
                ctx.moveTo(this.x - this.size, this.y - flap);
                ctx.lineTo(this.x, this.y);
                ctx.lineTo(this.x + this.size, this.y - flap);
                ctx.stroke();
            }
        }

        // Init Birds
        for(let i=0; i<10; i++) birds.push(new Bird());

        function drawSky() {
            // Sunset Gradient
            const grad = ctx.createLinearGradient(0, 0, 0, height);
            grad.addColorStop(0, '#0a0a20'); // Space
            grad.addColorStop(0.5, '#4a3b52'); // Purple Haze
            grad.addColorStop(1, '#ff9966'); // Peach Horizon
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, width, height);

            // Sun
            const sunY = height * 0.6;
            const sunGrad = ctx.createRadialGradient(cx, sunY, 10, cx, sunY, 200);
            sunGrad.addColorStop(0, 'rgba(255, 255, 200, 0.8)');
            sunGrad.addColorStop(1, 'rgba(255, 150, 100, 0)');
            ctx.fillStyle = sunGrad;
            ctx.fillRect(0, 0, width, height);
        }

        function drawOcean() {
            const oceanY = height * 0.6;
            
            // Draw Layers
            for(let i=0; i<5; i++) {
                ctx.beginPath();
                const colorVal = 50 + (i * 30);
                ctx.fillStyle = `rgba(0, ${colorVal + 50}, ${colorVal + 100}, ${0.4 + (i*0.1)})`;
                
                ctx.moveTo(0, height);
                for(let x=0; x<=width; x+=20) {
                    // Wave Math: Multiple sine waves combining
                    const wave = Math.sin(x * 0.01 + time + i) * (20 + (waveHeight * 50)) * (1 - (i*0.1));
                    // Detail wave
                    const detail = Math.sin(x * 0.05 - time * 2) * 5;
                    
                    ctx.lineTo(x, oceanY + (i * 40) + wave + detail);
                }
                ctx.lineTo(width, height);
                ctx.fill();
                
                // Foam (High pass)
                if (i === 0 && waveHeight > 0.7) {
                    ctx.strokeStyle = `rgba(255, 255, 255, ${(waveHeight-0.7)})`;
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            }
        }

        function drawMandala(analysis) {
            // Visualize the "Math" of the distribution
            if (!analysis) return;

            ctx.save();
            ctx.translate(cx, height * 0.3); // Center in sky
            
            // 3 Rings for 3 Frequency Bands (Bass, Mid, High)
            const bands = [
                analysis[2],  // Low (Ocean)
                analysis[20], // Mid (Wind)
                analysis[100] // High (Life)
            ];
            
            bands.forEach((val, i) => {
                const v = val / 255;
                ctx.beginPath();
                ctx.strokeStyle = `hsla(${180 + i*40}, 80%, 70%, 0.3)`;
                ctx.lineWidth = 2;
                const r = 50 + (i * 30) + (v * 50);
                ctx.arc(0, 0, r, 0, Math.PI*2);
                ctx.stroke();
                
                // Rotating orbital
                const ang = time * (i + 1) * 0.5;
                ctx.fillStyle = '#fff';
                ctx.beginPath();
                ctx.arc(Math.cos(ang)*r, Math.sin(ang)*r, 2, 0, Math.PI*2);
                ctx.fill();
            });
            
            ctx.restore();

            // Update text
            document.getElementById('val-ocean').innerText = Math.floor(bands[0]/255 * 100);
            document.getElementById('val-wind').innerText = Math.floor(bands[1]/255 * 100);
            document.getElementById('val-life').innerText = Math.floor(bands[2]/255 * 100);
        }

        function render() {
            if (!isRunning) return;
            requestAnimationFrame(render);
            time += 0.01;

            // Get Audio Data
            let data = null;
            if(analyser) {
                data = new Uint8Array(analyser.frequencyBinCount);
                analyser.getByteFrequencyData(data);
                // Map low freq to wave height (0 to 1)
                waveHeight = data[10] / 255; 
            }

            drawSky();
            drawMandala(data);
            
            birds.forEach(b => { b.update(); b.draw(); });
            
            drawOcean();
        }

        /* ------------------------------------------------
           AUDIO ENGINE: THE HARMONIC DISTRIBUTION
           ------------------------------------------------ */
        const AC = window.AudioContext || window.webkitAudioContext;
        let actx, master, analyser;

        function initAudio() {
            actx = new AC();
            
            // Master Compressor (The Glue)
            const comp = actx.createDynamicsCompressor();
            comp.threshold.value = -20;
            comp.ratio.value = 10;
            comp.connect(actx.destination);

            master = actx.createGain();
            master.gain.value = 0.8;
            master.connect(comp);

            // Analyser
            analyser = actx.createAnalyser();
            analyser.fftSize = 512;
            analyser.smoothingTimeConstant = 0.9; // Smooth visuals
            master.connect(analyser);

            // 1. THE OCEAN (50% - Brown Noise)
            createOceanNode();

            // 2. THE WIND (25% - Pink Noise)
            createWindNode();

            // 3. THE HARMONY (5% - Pad)
            createPadNode();

            // 4. THE WILDLIFE (15% - Chirps)
            startWildlifeLoop();
        }

        function createOceanNode() {
            // Brown Noise Buffer
            const bSize = actx.sampleRate * 2;
            const b = actx.createBuffer(1, bSize, actx.sampleRate);
            const d = b.getChannelData(0);
            let last = 0;
            for(let i=0; i<bSize; i++) {
                const w = Math.random() * 2 - 1;
                d[i] = (last + (0.02 * w)) / 1.02;
                last = d[i];
                d[i] *= 3.5;
            }
            const noise = actx.createBufferSource();
            noise.buffer = b;
            noise.loop = true;

            // Lowpass that breathes (The Waves)
            const filter = actx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 200; 

            const lfo = actx.createOscillator();
            lfo.frequency.value = 0.15; // Wave frequency (every 6-7 seconds)
            const lfoG = actx.createGain();
            lfoG.gain.value = 400; // Sweep range
            
            lfo.connect(lfoG);
            lfoG.connect(filter.frequency);

            const gain = actx.createGain();
            gain.gain.value = 0.5;

            noise.connect(filter);
            filter.connect(gain);
            gain.connect(master);
            
            noise.start();
            lfo.start();
        }

        function createWindNode() {
            // Pink Noise (Approximated)
            const bSize = actx.sampleRate * 2;
            const b = actx.createBuffer(1, bSize, actx.sampleRate);
            const d = b.getChannelData(0);
            for(let i=0; i<bSize; i++) {
                d[i] = (Math.random() * 2 - 1) * 0.5; // Rough pink
            }
            const noise = actx.createBufferSource();
            noise.buffer = b;
            noise.loop = true;

            // Bandpass for "Airy" sound
            const filter = actx.createBiquadFilter();
            filter.type = 'bandpass';
            filter.frequency.value = 800;
            filter.Q.value = 1;

            const panner = actx.createStereoPanner();
            // Pan LFO
            const lfo = actx.createOscillator();
            lfo.frequency.value = 0.1;
            const lfoG = actx.createGain();
            lfoG.gain.value = 0.5;
            lfo.connect(lfoG);
            lfoG.connect(panner.pan);

            const gain = actx.createGain();
            gain.gain.value = 0.2;

            noise.connect(filter);
            filter.connect(gain);
            gain.connect(panner);
            panner.connect(master);
            
            noise.start();
            lfo.start();
        }

        function createPadNode() {
            // E Major Pad (E, G#, B) - Very subtle
            const freqs = [164.81, 207.65, 246.94];
            const gain = actx.createGain();
            gain.gain.value = 0.05; // Very quiet
            gain.connect(master);

            freqs.forEach(f => {
                const osc = actx.createOscillator();
                osc.type = 'sine';
                osc.frequency.value = f;
                osc.connect(gain);
                osc.start();
            });
        }

        function startWildlifeLoop() {
            // Random Chirps
            setInterval(() => {
                if(Math.random() > 0.7) playChirp();
                if(Math.random() > 0.95) playFizz();
            }, 1000);
        }

        function playChirp() {
            const osc = actx.createOscillator();
            const g = actx.createGain();
            
            osc.frequency.value = 2000 + Math.random() * 1000;
            osc.type = 'triangle';
            
            // Quick chirp envelope
            g.gain.setValueAtTime(0, actx.currentTime);
            g.gain.linearRampToValueAtTime(0.05, actx.currentTime + 0.05);
            g.gain.exponentialRampToValueAtTime(0.001, actx.currentTime + 0.2);

            // Pitch drop
            osc.frequency.exponentialRampToValueAtTime(osc.frequency.value / 2, actx.currentTime + 0.2);

            osc.connect(g);
            g.connect(master);
            osc.start();
            osc.stop(actx.currentTime + 0.3);
        }

        function playFizz() {
            // White noise burst (Foam pop)
            const bSize = actx.sampleRate * 0.1;
            const b = actx.createBuffer(1, bSize, actx.sampleRate);
            const d = b.getChannelData(0);
            for(let i=0;i<bSize;i++) d[i] = Math.random()*2-1;
            
            const src = actx.createBufferSource();
            src.buffer = b;
            
            const f = actx.createBiquadFilter();
            f.type = 'highpass'; f.frequency.value = 5000;
            
            const g = actx.createGain();
            g.gain.setValueAtTime(0.05, actx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.001, actx.currentTime + 0.1);
            
            src.connect(f); f.connect(g); g.connect(master);
            src.start();
        }


        // INIT
        document.getElementById('btn-init').addEventListener('click', () => {
            const ui = document.getElementById('ui');
            ui.style.opacity = 0;
            setTimeout(() => ui.style.display = 'none', 1000);
            document.getElementById('readout').style.opacity = 1;

            resize();
            initAudio();
            if (actx.state === 'suspended') actx.resume();
            isRunning = true;
            render();
        });

    </script>
</body>
</html>
