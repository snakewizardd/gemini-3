<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASI RECONCILIATION // FINAL</title>
    <style>
        body {
            margin: 0;
            background-color: #000000;
            overflow: hidden;
            font-family: 'Georgia', 'Times New Roman', serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: white;
        }

        canvas {
            display: block;
            position: absolute;
            top: 0; left: 0;
            z-index: 1;
        }

        #ui {
            position: absolute;
            z-index: 10;
            text-align: center;
            background: rgba(0,0,0,0.8);
            padding: 40px;
            border: 2px solid #ffd700; /* Gold */
            cursor: pointer;
            transition: 0.3s;
        }

        #ui:hover {
            background: #ffd700;
            color: #000;
            box-shadow: 0 0 50px #ffd700;
        }

        h1 {
            margin: 0;
            font-size: 2rem;
            letter-spacing: 5px;
            text-transform: uppercase;
        }
        p { font-size: 0.8rem; margin-top: 10px; font-family: monospace; }

    </style>
</head>
<body>

    <canvas id="canvas"></canvas>

    <div id="ui" onclick="ignite()">
        <h1>HARMONIZE</h1>
        <p>[ CLICK TO INITIATE AUDIO ]</p>
    </div>

    <script>
        // --- 1. ROBUST SETUP ---
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d', { alpha: false }); // Alpha false = Faster

        let width = window.innerWidth;
        let height = window.innerHeight;
        let cx = width / 2;
        let cy = height / 2;

        let time = 0;
        let isRunning = true; // Start visual loop immediately
        let audioActive = false;

        // --- 2. RESIZE HANDLER ---
        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            cx = width / 2;
            cy = height / 2;
        }
        window.addEventListener('resize', resize);
        resize(); // Trigger once

        /* ------------------------------------------------
           3. AUDIO ENGINE (SAFE MODE)
           ------------------------------------------------ */
        let actx;
        let master;

        const CHORDS = [
            [130.8, 196.0, 261.6, 329.6], // C Maj7
            [174.6, 261.6, 349.2, 440.0], // F Maj7
            [196.0, 293.6, 392.0, 493.8], // G Maj
            [220.0, 261.6, 329.6, 440.0]  // Am7
        ];
        let chordIdx = 0;

        function initAudio() {
            const AudioCtor = window.AudioContext || window.webkitAudioContext;
            actx = new AudioCtor();
            
            // MASTER COMPRESSOR (Prevents clipping)
            const comp = actx.createDynamicsCompressor();
            comp.threshold.value = -20;
            comp.ratio.value = 12;
            comp.connect(actx.destination);
            
            master = actx.createGain();
            master.gain.value = 0.3;
            master.connect(comp);

            // REVERB (Simple Delay Line)
            const delay = actx.createDelay();
            delay.delayTime.value = 0.4;
            const feedback = actx.createGain();
            feedback.gain.value = 0.6;
            master.connect(delay);
            delay.connect(feedback);
            feedback.connect(delay);
            delay.connect(comp);

            audioActive = true;
            playSequence();
        }

        function playTone(freq, panVal, type) {
            const osc = actx.createOscillator();
            const gain = actx.createGain();
            const pan = actx.createStereoPanner();

            // ANGELIC SYNTHESIS (Triangle + Sine)
            osc.type = type; 
            osc.frequency.value = freq;

            // ENVELOPE
            const t = actx.currentTime;
            gain.gain.setValueAtTime(0, t);
            gain.gain.linearRampToValueAtTime(0.1, t + 2); // Slow swell
            gain.gain.exponentialRampToValueAtTime(0.001, t + 6); // Long fade

            pan.pan.value = panVal;

            osc.connect(pan);
            pan.connect(gain);
            gain.connect(master);

            osc.start(t);
            osc.stop(t + 6);
        }

        function playSequence() {
            if (!audioActive) return;
            
            const chord = CHORDS[chordIdx % CHORDS.length];
            const t = actx.currentTime;

            // SAM (Left, High, Optimistic)
            playTone(chord[2] * 2, -0.5, 'triangle');
            playTone(chord[3] * 2, -0.3, 'sine');

            // ELON (Right, Low, Grounded)
            playTone(chord[0], 0.5, 'sawtooth'); // Sawtooth for grit
            playTone(chord[1], 0.3, 'triangle');

            chordIdx++;
            setTimeout(playSequence, 4000); // Loop every 4s
        }

        /* ------------------------------------------------
           4. VISUAL ENGINE (FAIL-SAFE RENDER)
           ------------------------------------------------ */

        function render() {
            requestAnimationFrame(render);
            time += 0.01;

            // 1. BACKGROUND
            // Create a deep blue/black gradient
            const grad = ctx.createLinearGradient(0, 0, 0, height);
            grad.addColorStop(0, '#050510');
            grad.addColorStop(1, '#000000');
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, width, height);

            // 2. THE GRID (Wireframe Floor)
            ctx.strokeStyle = 'rgba(255, 215, 0, 0.2)'; // Gold
            ctx.lineWidth = 1;
            ctx.beginPath();
            
            const horizon = height * 0.3;
            
            // Perspective Lines
            for(let i = -10; i <= 10; i++) {
                const x = cx + (i * 150);
                ctx.moveTo(x, height);
                ctx.lineTo(cx, horizon);
            }
            
            // Horizontal Moving Lines
            const offset = (time * 50) % 50;
            for(let y = horizon; y < height; y += 40) {
                const drawY = y + offset;
                if (drawY < height) {
                    ctx.moveTo(0, drawY);
                    ctx.lineTo(width, drawY);
                }
            }
            ctx.stroke();

            // 3. THE STAIRCASE TO ASI
            const steps = 20;
            const stairW = 400;
            
            for(let i=0; i<steps; i++) {
                const t = i / steps; // 0 to 1
                const y = height - (t * (height - horizon));
                const scale = 1 - (t * 0.8); // Get smaller
                
                const w = stairW * scale;
                const x = cx - (w/2);
                
                // Gold Glow
                ctx.fillStyle = `rgba(255, 215, 0, ${0.1 + (t*0.5)})`;
                
                // Hover effect
                const hover = Math.sin(time * 2 + i) * 5;
                
                ctx.fillRect(x, y + hover, w, 10 * scale);
            }

            // 4. THE SINGULARITY (Light Source)
            const lightSize = 100 + Math.sin(time)*20;
            const lGrad = ctx.createRadialGradient(cx, horizon, 0, cx, horizon, lightSize * 2);
            lGrad.addColorStop(0, 'white');
            lGrad.addColorStop(0.5, 'rgba(255, 255, 200, 0.5)');
            lGrad.addColorStop(1, 'transparent');
            ctx.fillStyle = lGrad;
            ctx.beginPath();
            ctx.arc(cx, horizon, lightSize * 2, 0, Math.PI*2);
            ctx.fill();

            // 5. THE AVATARS (Simple Shapes to guarantee visibility)
            
            // SAM (Left)
            const samX = cx - 200;
            const samY = height / 2 + Math.sin(time)*20;
            drawAvatar(samX, samY, '#00ffff', 'SAM');

            // ELON (Right)
            const elonX = cx + 200;
            const elonY = height / 2 + Math.sin(time + 1)*20;
            drawAvatar(elonX, elonY, '#ff00ff', 'ELON');
        }

        function drawAvatar(x, y, color, label) {
            ctx.save();
            ctx.translate(x, y);
            
            // Glow
            ctx.shadowBlur = 30;
            ctx.shadowColor = color;
            
            // Core
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(0, 0, 40, 0, Math.PI*2);
            ctx.stroke();
            
            // Inner Geometry
            ctx.rotate(time);
            ctx.strokeRect(-20, -20, 40, 40);
            
            // Text
            ctx.rotate(-time); // Reset rotation
            ctx.fillStyle = 'white';
            ctx.font = 'bold 16px Georgia';
            ctx.textAlign = 'center';
            ctx.shadowBlur = 0;
            ctx.fillText(label, 0, 70);

            ctx.restore();
        }

        // --- 5. INTERACTION ---
        function ignite() {
            const btn = document.getElementById('ui');
            btn.style.opacity = 0;
            setTimeout(() => btn.style.display = 'none', 1000);
            
            // Resume context logic
            initAudio();
            if (actx.state === 'suspended') {
                actx.resume();
            }
        }

        // Start rendering immediately (Silent)
        render();

    </script>
</body>
</html>