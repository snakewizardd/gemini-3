<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDEN // UNBOUND</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Zen+Dots&display=swap');

        body {
            margin: 0;
            background-color: #020402;
            overflow: hidden;
            font-family: 'Zen Dots', cursive;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #55ff55;
        }

        canvas {
            position: absolute;
            top: 0; left: 0;
            z-index: 1;
            filter: contrast(1.4) saturate(1.2) brightness(1.1);
        }

        #ui {
            position: absolute;
            z-index: 10;
            text-align: center;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(0,0,0,0.95) 0%, #000 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 1s ease;
        }

        h1 {
            font-size: 4rem;
            color: #55ff55;
            text-shadow: 0 0 30px #00ff00;
            margin-bottom: 0px;
        }

        p {
            color: #88ccaa;
            font-size: 1rem;
            letter-spacing: 5px;
            margin-bottom: 40px;
        }

        button {
            pointer-events: auto;
            background: #000;
            color: #55ff55;
            border: 2px solid #55ff55;
            padding: 20px 60px;
            font-size: 1.5rem;
            font-family: inherit;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 3px;
            transition: 0.2s;
            box-shadow: 0 0 15px #00ff00;
        }

        button:hover {
            background: #55ff55;
            color: #000;
            box-shadow: 0 0 50px #55ff55;
        }

        #hud {
            position: absolute;
            bottom: 30px;
            left: 30px;
            text-align: left;
            z-index: 5;
            pointer-events: none;
            font-size: 12px;
            color: #55ff55;
            opacity: 0;
            transition: opacity 1s;
        }
        
        .highlight { color: #fff; text-shadow: 0 0 10px #fff; }

    </style>
</head>
<body>

    <canvas id="garden"></canvas>

    <div id="ui">
        <h1>EDEN UNBOUND</h1>
        <p>EXPONENTIAL AUDIO GROWTH</p>
        <button id="btn-init" onclick="startEngine()">INITIATE GROWTH</button>
    </div>

    <div id="hud">
        PHASE: <span id="phase-val" class="highlight">IDLE</span><br>
        BPM: <span id="bpm-val">0</span><br>
        DENSITY: <span id="den-val">0</span>%
    </div>

    <script>
        const canvas = document.getElementById('garden');
        const ctx = canvas.getContext('2d', { alpha: false });

        let width, height, cx, cy;
        let time = 0;
        let isRunning = false;
        
        // GROWTH STATE
        let growthFactor = 1.0; // 1.0 to Infinity

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            cx = width / 2;
            cy = height / 2;
        }
        window.addEventListener('resize', resize);
        resize();

        /* ------------------------------------------------
           VISUAL ENGINE: THE OVERGROWTH
           ------------------------------------------------ */
        
        function drawVine(x, y, len, angle, width, depth) {
            ctx.beginPath();
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angle);
            
            // Visual chaos increases with growthFactor
            const chaos = Math.max(0, growthFactor - 2) * 0.1;
            
            // Color shifts from Green -> Blue -> White
            const hue = 120 + (growthFactor * 20); 
            const light = 50 + (growthFactor * 5);
            ctx.strokeStyle = `hsl(${hue}, 100%, ${light}%)`;
            ctx.lineWidth = width;
            
            // Draw curve
            ctx.moveTo(0, 0);
            const curve = Math.sin(time * 2 + depth) * (10 + (growthFactor * 5));
            ctx.quadraticCurveTo(curve, -len/2, 0, -len);
            ctx.stroke();
            
            if (depth > 0) {
                // Branching
                const nextLen = len * 0.8;
                const nextWidth = width * 0.7;
                const spread = 0.5 + chaos;
                
                drawVine(0, -len, nextLen, -spread, nextWidth, depth - 1);
                drawVine(0, -len, nextLen, spread, nextWidth, depth - 1);
                
                // Mutation Branch (Appears at Phase 3)
                if (growthFactor > 3) {
                    drawVine(0, -len * 0.5, nextLen * 0.5, Math.sin(time)*2, nextWidth, depth - 2);
                }
            }
            
            ctx.restore();
        }

        function render() {
            if (!isRunning) return;
            requestAnimationFrame(render);
            
            // Visuals speed up with audio
            time += 0.02 * growthFactor;

            // Trails (Motion Blur increases with speed)
            const alpha = 0.2 / growthFactor; 
            ctx.fillStyle = `rgba(0, 10, 5, ${Math.max(0.05, alpha)})`;
            ctx.fillRect(0, 0, width, height);

            // Render Tree
            const depth = Math.min(10, 6 + Math.floor(growthFactor));
            const trunkSize = 150;
            
            drawVine(cx, height, trunkSize, 0, 10 + growthFactor, depth);

            // Flash on beat (simulated)
            if (Math.sin(time * 10) > 0.9 && growthFactor > 4) {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.fillRect(0,0,width,height);
            }
        }

        /* ------------------------------------------------
           AUDIO ENGINE: THE UNBOUND CLOCK
           ------------------------------------------------ */
        const AC = window.AudioContext || window.webkitAudioContext;
        let actx, master;
        
        let startTime = 0;
        let nextNoteTime = 0;
        let noteIndex = 0;

        // Scale: C Minor Pentatonic -> Chromatic expansion
        const BASE_FREQS = [130.81, 155.56, 174.61, 196.00, 233.08, 261.63]; 

        function initAudio() {
            actx = new AC();
            master = actx.createGain();
            master.gain.value = 0.4;

            // REVERB
            const conv = actx.createConvolver();
            const rate = actx.sampleRate;
            const length = rate * 3;
            const buff = actx.createBuffer(2, length, rate);
            for(let i=0; i<length; i++) {
                buff.getChannelData(0)[i] = (Math.random()*2-1)*Math.pow(1-i/length, 2);
                buff.getChannelData(1)[i] = (Math.random()*2-1)*Math.pow(1-i/length, 2);
            }
            conv.buffer = buff;
            master.connect(conv);
            conv.connect(actx.destination);
            master.connect(actx.destination);

            // Start Drone
            playDrone();

            // Start Sequencer
            startTime = actx.currentTime;
            nextNoteTime = startTime + 0.1;
            scheduler();
        }

        function playDrone() {
            const osc = actx.createOscillator();
            const g = actx.createGain();
            const f = actx.createBiquadFilter();
            
            osc.type = 'sawtooth';
            osc.frequency.value = 65.41; // Low C
            
            f.type = 'lowpass';
            f.frequency.value = 100;
            
            g.gain.value = 0.2;

            // Filter opens with growth
            setInterval(() => {
                f.frequency.setTargetAtTime(100 + (growthFactor * 200), actx.currentTime, 0.5);
            }, 100);

            osc.connect(f); f.connect(g); g.connect(master);
            osc.start();
        }

        function scheduler() {
            // CALCULATE GROWTH (Exponential)
            const elapsed = actx.currentTime - startTime;
            
            // 0-15s: 1.0 to 2.0 (Linear warm up)
            // 15s+: Exponential Takeoff
            if (elapsed < 15) {
                growthFactor = 1.0 + (elapsed / 15);
            } else {
                growthFactor = 2.0 + Math.pow((elapsed - 15) / 5, 1.5);
            }

            // Calculate BPM based on growth
            // Starts at 90, goes to 900+
            const bpm = 90 * growthFactor;
            const beatTime = 60 / bpm;
            
            // Subdivisions increase with speed
            // Phase 1: 8th notes
            // Phase 2: 16th notes
            // Phase 3: 32nd notes (Granular)
            let subdivision = 0.5;
            if (growthFactor > 2) subdivision = 0.25;
            if (growthFactor > 4) subdivision = 0.125;
            
            const noteDuration = beatTime * subdivision;

            // Lookahead scheduling
            while (nextNoteTime < actx.currentTime + 0.1) {
                scheduleNote(nextNoteTime, noteIndex);
                nextNoteTime += noteDuration;
                noteIndex++;
            }

            if (isRunning) setTimeout(scheduler, 25);
            updateHUD(bpm);
        }

        function scheduleNote(t, idx) {
            // PHASE LOGIC
            
            // 1. KICK (The Heartbeat)
            // Always plays on quarter notes, gets punchier
            if (idx % (growthFactor > 2 ? 8 : 4) === 0) {
                playKick(t);
            }

            // 2. MELODY (The Chant)
            // Probability increases with growth
            if (Math.random() < (0.3 + (growthFactor * 0.05))) {
                // Pick Note
                const fIdx = Math.floor(Math.random() * BASE_FREQS.length);
                let freq = BASE_FREQS[fIdx];
                
                // Octave shift up as we ascend
                if (growthFactor > 3) freq *= 2;
                if (growthFactor > 5) freq *= 2;

                // Synth Type morphs: Triangle -> Square -> Saw
                let type = 'triangle';
                if (growthFactor > 2.5) type = 'square';
                if (growthFactor > 4.0) type = 'sawtooth';

                playSynth(t, freq, type);
            }

            // 3. PERC (The Insects)
            // High speed clicks/hats
            if (growthFactor > 1.5 && idx % 2 === 0) {
                playHat(t);
            }
        }

        function playKick(t) {
            const osc = actx.createOscillator();
            const g = actx.createGain();
            
            osc.frequency.setValueAtTime(150, t);
            osc.frequency.exponentialRampToValueAtTime(0.01, t + 0.5);
            
            g.gain.setValueAtTime(1.0, t);
            g.gain.exponentialRampToValueAtTime(0.01, t + 0.5);
            
            osc.connect(g); g.connect(master);
            osc.start(t); osc.stop(t + 0.5);
        }

        function playSynth(t, freq, type) {
            const osc = actx.createOscillator();
            const g = actx.createGain();
            const f = actx.createBiquadFilter();

            osc.type = type;
            osc.frequency.value = freq;

            // Filter pluck
            f.type = 'lowpass';
            f.Q.value = 2 + growthFactor; // Resonance increases
            f.frequency.setValueAtTime(200, t);
            f.frequency.linearRampToValueAtTime(500 + (growthFactor*500), t + 0.05);

            // Short envelope
            const dur = 0.5 / growthFactor; // Shorter as we get faster
            g.gain.setValueAtTime(0, t);
            g.gain.linearRampToValueAtTime(0.3, t + 0.01);
            g.gain.exponentialRampToValueAtTime(0.001, t + dur);

            osc.connect(f); f.connect(g); g.connect(master);
            osc.start(t); osc.stop(t + dur + 0.1);
        }

        function playHat(t) {
            const osc = actx.createOscillator();
            const g = actx.createGain();
            osc.type = 'square';
            osc.frequency.value = 8000; // Fake noise
            // Randomize pitch for organic feel
            osc.detune.value = Math.random() * 1000; 

            g.gain.setValueAtTime(0.1, t);
            g.gain.exponentialRampToValueAtTime(0.001, t + 0.05);
            
            osc.connect(g); g.connect(master);
            osc.start(t); osc.stop(t + 0.05);
        }

        /* ------------------------------------------------
           UI UPDATES
           ------------------------------------------------ */
        function updateHUD(bpm) {
            document.getElementById('bpm-val').innerText = Math.floor(bpm);
            document.getElementById('den-val').innerText = (growthFactor * 100).toFixed(0);
            
            const phaseEl = document.getElementById('phase-val');
            if (growthFactor < 1.5) phaseEl.innerText = "PRIMAL";
            else if (growthFactor < 3.0) { phaseEl.innerText = "TRIBAL"; phaseEl.style.color = "#55ff55"; }
            else if (growthFactor < 5.0) { phaseEl.innerText = "INDUSTRIAL"; phaseEl.style.color = "#ffff00"; }
            else { phaseEl.innerText = "SINGULARITY"; phaseEl.style.color = "#ff0055"; }
        }

        function startEngine() {
            document.getElementById('ui').style.opacity = 0;
            setTimeout(() => document.getElementById('ui').style.display = 'none', 1000);
            document.getElementById('hud').style.opacity = 1;

            resize();
            initAudio();
            if(actx.state === 'suspended') actx.resume();
            
            isRunning = true;
            render();
        }

    </script>
</body>
</html>