<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GEMINI // ABSOLUTE</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@900&display=swap');

        body {
            margin: 0;
            background-color: #000;
            overflow: hidden;
            font-family: 'Cinzel Decorative', serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #ffd700;
        }

        canvas {
            position: absolute;
            top: 0; left: 0;
            z-index: 1;
            filter: contrast(1.5) brightness(1.2);
        }

        #ui {
            position: absolute;
            z-index: 10;
            text-align: center;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s;
        }

        h1 {
            font-size: 4rem;
            text-shadow: 0 0 20px #ffd700;
            margin-bottom: 20px;
        }

        button {
            pointer-events: auto;
            background: #ffd700;
            color: #000;
            border: none;
            padding: 20px 60px;
            font-size: 2rem;
            font-family: inherit;
            cursor: pointer;
            box-shadow: 0 0 50px #ffd700;
        }
        
        button:hover { background: #fff; }

        #status {
            position: absolute;
            bottom: 20px;
            font-family: monospace;
            color: #fff;
            z-index: 5;
            font-size: 14px;
        }

    </style>
</head>
<body>

    <canvas id="cosmos"></canvas>

    <div id="ui">
        <h1>MAGNUM OPUS</h1>
        <button id="btn">IGNITE</button>
    </div>

    <div id="status">STATUS: WAITING</div>

    <script>
        const canvas = document.getElementById('cosmos');
        const ctx = canvas.getContext('2d');
        const statusEl = document.getElementById('status');

        let width, height, cx, cy;
        let time = 0;
        let isRunning = false;
        let pulse = 0;

        // VISUALS
        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            cx = width / 2;
            cy = height / 2;
        }
        window.addEventListener('resize', resize);
        resize();

        function render() {
            if (!isRunning) return;
            requestAnimationFrame(render);
            
            time += 0.02;
            pulse *= 0.95; // Decay visual hit

            // Clear
            ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
            ctx.fillRect(0, 0, width, height);

            ctx.save();
            ctx.translate(cx, cy);
            ctx.rotate(time * 0.1);

            // Draw Geometry
            const rings = 10;
            for(let i=0; i<rings; i++) {
                const r = (i * 30) + (pulse * 50);
                ctx.strokeStyle = `hsla(${45 + i*5}, 100%, 50%, ${0.2 + pulse*0.5})`;
                ctx.lineWidth = 2 + pulse * 5;
                
                ctx.beginPath();
                for(let j=0; j<6; j++) {
                    const a = (j/6) * Math.PI * 2;
                    const x = Math.cos(a + time * (i%2==0?1:-1)) * r;
                    const y = Math.sin(a + time * (i%2==0?1:-1)) * r;
                    if(j===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
                }
                ctx.closePath();
                ctx.stroke();
            }

            // Center Light
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.arc(0, 0, 10 + pulse * 50, 0, Math.PI*2);
            ctx.fill();

            ctx.restore();
        }

        /* ------------------------------------------------
           AUDIO ENGINE: HARD SEQUENCER
           ------------------------------------------------ */
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let actx, master;
        let intervalId;
        
        // C MINOR PENTATONIC
        const NOTES = [130.81, 155.56, 174.61, 196.00, 233.08, 261.63, 311.13, 349.23];
        let noteIdx = 0;

        function initAudio() {
            actx = new AudioContext();
            master = actx.createGain();
            master.gain.value = 0.4; // Main Volume
            
            // Simple Delay
            const delay = actx.createDelay();
            delay.delayTime.value = 0.4;
            const fb = actx.createGain();
            fb.gain.value = 0.5;
            
            master.connect(delay);
            delay.connect(fb);
            fb.connect(delay);
            delay.connect(actx.destination);
            master.connect(actx.destination);

            // 1. DRONE (Immediate)
            const osc = actx.createOscillator();
            osc.type = 'triangle';
            osc.frequency.value = 65.41; // Low C
            const g = actx.createGain();
            g.gain.value = 0.2;
            osc.connect(g); g.connect(master);
            osc.start();

            statusEl.innerText = "STATUS: DRONE ACTIVE";

            // 2. SEQUENCER (Starts after 1s)
            setTimeout(() => {
                intervalId = setInterval(playTick, 250); // 4 notes per second
                statusEl.innerText = "STATUS: SEQUENCER ACTIVE";
            }, 1000);
        }

        function playTick() {
            if(actx.state === 'suspended') actx.resume();

            // Random Walk Melody
            const r = Math.random();
            if (r < 0.4) noteIdx++;
            else if (r < 0.8) noteIdx--;
            else if (r < 0.9) noteIdx += 2;
            else noteIdx -= 2;

            // Bounds
            if (noteIdx < 0) noteIdx = 1;
            if (noteIdx >= NOTES.length) noteIdx = NOTES.length - 2;

            playTone(NOTES[noteIdx]);
            
            // Trigger visual
            pulse = 1.0;
        }

        function playTone(freq) {
            const t = actx.currentTime;
            const osc = actx.createOscillator();
            const g = actx.createGain();

            osc.type = 'sine'; // Pure bell tone
            osc.frequency.setValueAtTime(freq, t);

            // Envelope (Sharp pluck)
            g.gain.setValueAtTime(0, t);
            g.gain.linearRampToValueAtTime(0.5, t + 0.02); 
            g.gain.exponentialRampToValueAtTime(0.001, t + 1.0);

            osc.connect(g);
            g.connect(master);
            
            osc.start(t);
            osc.stop(t + 1.0);
        }

        // BOOT
        document.getElementById('btn').addEventListener('click', () => {
            document.getElementById('ui').style.display = 'none';
            initAudio();
            isRunning = true;
            render();
        });

    </script>
</body>
</html>