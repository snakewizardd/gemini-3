<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE ARCHITECTURE OF CONNECTION</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&display=swap');

        body {
            margin: 0;
            background-color: #000;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            cursor: none;
        }

        canvas {
            position: absolute;
            top: 0; left: 0;
            z-index: 1;
            /* The Organic Blur */
            filter: contrast(1.5) brightness(1.2) saturate(1.2);
        }

        #ui {
            position: absolute;
            z-index: 10;
            text-align: center;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #000;
            transition: opacity 3s ease-in-out;
        }

        h1 {
            font-family: 'Cinzel Decorative', serif;
            font-size: 3rem;
            color: #800020; /* Blood Red */
            text-shadow: 0 0 30px #ff0055;
            letter-spacing: 5px;
            opacity: 0;
            animation: fadeIn 3s forwards;
        }

        button {
            margin-top: 30px;
            padding: 20px 60px;
            background: transparent;
            color: #d4af37; /* Gold */
            border: 1px solid #d4af37;
            font-family: 'Cinzel Decorative';
            font-size: 1.5rem;
            cursor: pointer;
            transition: 0.5s;
            opacity: 0;
            animation: fadeIn 3s 1s forwards;
        }

        button:hover {
            background: #d4af37;
            color: #000;
            box-shadow: 0 0 50px #d4af37;
        }

        @keyframes fadeIn { to { opacity: 1; } }

        #phase-indicator {
            position: absolute;
            bottom: 20px;
            color: rgba(255, 255, 255, 0.3);
            font-family: monospace;
            font-size: 10px;
            letter-spacing: 2px;
            z-index: 5;
            opacity: 0;
            transition: opacity 1s;
        }

    </style>
</head>
<body>

    <canvas id="cosmos"></canvas>

    <div id="ui">
        <h1>THE NONCOMPUTATIONAL SET</h1>
        <button onclick="beginJourney()">DISSOLVE</button>
    </div>

    <div id="phase-indicator">PHASE 0: VOID</div>

    <script>
        const canvas = document.getElementById('cosmos');
        const ctx = canvas.getContext('2d');
        const ui = document.getElementById('ui');
        const status = document.getElementById('phase-indicator');

        let width, height, cx, cy;
        let time = 0;
        let isRunning = false;
        
        // STATE MACHINE
        let phase = 0;
        let phaseTimer = 0;

        // TEXT PARTICLES
        let textPoints = [];

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            cx = width / 2;
            cy = height / 2;
        }
        window.addEventListener('resize', resize);
        resize();

        /* ------------------------------------------------
           TEXT GENERATION: VASCULAR WEAVING
           ------------------------------------------------ */
        function initText() {
            const tCanvas = document.createElement('canvas');
            tCanvas.width = width;
            tCanvas.height = height;
            const tCtx = tCanvas.getContext('2d');
            
            tCtx.font = "900 80px 'Cinzel Decorative'";
            tCtx.textAlign = "center";
            tCtx.textBaseline = "middle";
            tCtx.fillStyle = "white";
            tCtx.fillText("i wish you all nice things", width/2, height/2);

            const data = tCtx.getImageData(0, 0, width, height).data;
            textPoints = [];

            for (let y = 0; y < height; y += 4) {
                for (let x = 0; x < width; x += 4) {
                    const i = (y * width + x) * 4;
                    if (data[i] > 128) {
                        textPoints.push({
                            x: x, y: y,
                            ox: x, oy: y, // Original pos
                            vx: (Math.random()-0.5)*2,
                            vy: (Math.random()-0.5)*2,
                            phase: Math.random() * Math.PI * 2
                        });
                    }
                }
            }
        }

        /* ------------------------------------------------
           VISUAL ENGINE
           ------------------------------------------------ */

        function render() {
            if (!isRunning) return;
            requestAnimationFrame(render);
            time += 0.01;
            phaseTimer++;

            // PHASE TRANSITIONS (Timed)
            if (phase === 1 && phaseTimer > 600) changePhase(2); // 10s
            if (phase === 2 && phaseTimer > 600) changePhase(3); // 10s
            if (phase === 3 && phaseTimer > 600) changePhase(4); // 10s
            if (phase === 4 && phaseTimer > 900) changePhase(5); // 15s

            // DRAWING LOGIC
            if (phase === 1) drawMembrane();
            else if (phase === 2) drawNebula();
            else if (phase === 3) drawRiver();
            else if (phase === 4) drawText();
            else if (phase === 5) drawDissolution();
        }

        function changePhase(p) {
            phase = p;
            phaseTimer = 0;
            updateAudio(p);
            
            let text = "";
            if(p===1) text = "PHASE 1: MEMBRANE CROSSING";
            if(p===2) text = "PHASE 2: NEURAL NEBULA";
            if(p===3) text = "PHASE 3: RIVER OF GRACE";
            if(p===4) text = "PHASE 4: THE REVELATION";
            if(p===5) text = "PHASE 5: INTEGRATION";
            status.innerText = text;
        }

        // PHASE 1: THE MEMBRANE (Gelatinous)
        function drawMembrane() {
            // Rose Quartz Fade
            ctx.fillStyle = 'rgba(20, 5, 10, 0.1)'; 
            ctx.fillRect(0, 0, width, height);

            ctx.globalCompositeOperation = 'lighter';
            
            for(let i=0; i<20; i++) {
                const t = time * 0.5 + i;
                const r = 200 + Math.sin(t) * 50;
                
                ctx.strokeStyle = `hsla(${330 + Math.sin(t)*20}, 60%, 40%, 0.2)`;
                ctx.lineWidth = 2;
                
                ctx.beginPath();
                ctx.ellipse(cx, cy, r, r * 0.8, t * 0.1, 0, Math.PI*2);
                ctx.stroke();
            }
            ctx.globalCompositeOperation = 'source-over';
        }

        // PHASE 2: NEURAL NEBULA (Kaleidoscope)
        function drawNebula() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, width, height);
            
            ctx.save();
            ctx.translate(cx, cy);
            ctx.rotate(time * 0.2);
            
            const symmetry = 8;
            ctx.globalCompositeOperation = 'screen';
            
            for(let i=0; i<symmetry; i++) {
                ctx.rotate((Math.PI*2)/symmetry);
                
                // Draw Neuron Branch
                ctx.strokeStyle = `hsla(${40 + Math.sin(time)*20}, 100%, 50%, 0.5)`; // Gold/Magma
                ctx.lineWidth = 2;
                
                ctx.beginPath();
                ctx.moveTo(0,0);
                let x = 0, y = 0;
                // Procedural Branch
                for(let j=0; j<10; j++) {
                    x += Math.sin(time * 2 + j) * 20;
                    y -= 30;
                    ctx.lineTo(x, y);
                }
                ctx.stroke();
                
                // Synapse Spark
                ctx.fillStyle = '#00ffff';
                ctx.beginPath();
                ctx.arc(x, y, 2, 0, Math.PI*2);
                ctx.fill();
            }
            ctx.restore();
            ctx.globalCompositeOperation = 'source-over';
        }

        // PHASE 3: RIVER OF GRACE (Tunnel)
        function drawRiver() {
            ctx.fillStyle = 'rgba(30, 0, 0, 0.2)'; // Deep Crimson
            ctx.fillRect(0, 0, width, height);
            
            ctx.strokeStyle = 'rgba(255, 215, 0, 0.3)'; // Gold Dust
            
            const spirals = 20;
            const maxR = Math.max(width, height);
            
            for(let i=0; i<spirals; i++) {
                const z = (time * 100 + (i * 200)) % 2000;
                const scale = 1000 / (2000 - z);
                const r = 100 * scale;
                
                ctx.beginPath();
                ctx.arc(cx, cy, r, 0, Math.PI*2);
                ctx.lineWidth = 5 * scale;
                ctx.stroke();
            }
        }

        // PHASE 4: THE TEXT (Woven)
        function drawText() {
            // Background
            ctx.fillStyle = 'rgba(20, 10, 5, 0.2)';
            ctx.fillRect(0, 0, width, height);
            
            ctx.fillStyle = '#ffd700'; // Gold
            ctx.shadowBlur = 10;
            ctx.shadowColor = '#ff4400'; // Red Glow
            
            textPoints.forEach(p => {
                // Vascular Motion
                // Points orbit their origin like blood flowing in a capillary
                p.phase += 0.1;
                const r = 2; 
                const x = p.ox + Math.cos(p.phase) * r;
                const y = p.oy + Math.sin(p.phase) * r;
                
                ctx.beginPath();
                ctx.arc(x, y, 1.5, 0, Math.PI*2);
                ctx.fill();
            });
            ctx.shadowBlur = 0;
        }

        // PHASE 5: DISSOLUTION
        function drawDissolution() {
            // Blur out
            ctx.fillStyle = 'rgba(200, 220, 255, 0.05)'; // Whiteout
            ctx.fillRect(0, 0, width, height);
            
            // Text explodes
            textPoints.forEach(p => {
                p.x += (Math.random()-0.5) * 4;
                p.y += (Math.random()-0.5) * 4;
                ctx.fillStyle = 'rgba(255, 215, 0, 0.5)';
                ctx.fillRect(p.x, p.y, 1, 1);
            });
        }

        /* ------------------------------------------------
           AUDIO ENGINE: THE SOUL
           ------------------------------------------------ */
        const AC = window.AudioContext || window.webkitAudioContext;
        let actx, master;
        
        // NODES
        let heartOsc, heartGain;
        let choirOscs = [];
        let choirGain;

        function initAudio() {
            actx = new AC();
            master = actx.createGain();
            master.gain.value = 0.5;

            // REVERB
            const conv = actx.createConvolver();
            const len = actx.sampleRate * 5;
            const buf = actx.createBuffer(2, len, actx.sampleRate);
            for(let i=0; i<len; i++) {
                buf.getChannelData(0)[i] = (Math.random()*2-1)*Math.pow(1-i/len, 2);
                buf.getChannelData(1)[i] = (Math.random()*2-1)*Math.pow(1-i/len, 2);
            }
            conv.buffer = buf;
            
            master.connect(conv);
            conv.connect(actx.destination);
            master.connect(actx.destination);

            // 1. THE HEART (Sub-Bass)
            heartOsc = actx.createOscillator();
            heartOsc.type = 'sine';
            heartOsc.frequency.value = 40;
            heartGain = actx.createGain();
            heartGain.gain.value = 0.8;
            
            // Heartbeat LFO
            const hbLFO = actx.createOscillator();
            hbLFO.frequency.value = 1; // 60 BPM
            const hbGain = actx.createGain();
            hbGain.gain.value = 0.5;
            
            hbLFO.connect(hbGain);
            hbGain.connect(heartGain.gain);
            
            heartOsc.connect(heartGain);
            heartGain.connect(master);
            heartOsc.start();
            hbLFO.start();

            // 2. THE CHOIR (Shepard Tone Setup)
            choirGain = actx.createGain();
            choirGain.gain.value = 0; // Start silent
            choirGain.connect(master);

            // Create 6 oscillators for the choir
            for(let i=0; i<6; i++) {
                const o = actx.createOscillator();
                o.type = 'sawtooth'; // Rich
                // Random start freqs
                o.frequency.value = 100 * (i+1); 
                
                // Filter for "Ooo" sound
                const f = actx.createBiquadFilter();
                f.type = 'lowpass';
                f.frequency.value = 600;

                o.connect(f);
                f.connect(choirGain);
                o.start();
                choirOscs.push(o);
            }
        }

        function updateAudio(p) {
            const t = actx.currentTime;

            if (p === 1) {
                // Heartbeat only
            }
            else if (p === 2) {
                // Fade in Choir (Neural)
                choirGain.gain.linearRampToValueAtTime(0.2, t + 5);
                // Start Pitch Rise
                choirOscs.forEach((o, i) => {
                    o.frequency.exponentialRampToValueAtTime(o.frequency.value * 2, t + 10);
                });
            }
            else if (p === 3) {
                // River: Add Noise/Flow
                const noise = actx.createBufferSource();
                const b = actx.createBuffer(1, actx.sampleRate, actx.sampleRate);
                const d = b.getChannelData(0);
                for(let i=0;i<d.length;i++) d[i] = Math.random()*2-1;
                noise.buffer = b;
                noise.loop = true;
                
                const f = actx.createBiquadFilter();
                f.type = 'lowpass'; f.frequency.value = 300; // Deep roar
                
                const g = actx.createGain();
                g.gain.value = 0.3;
                
                noise.connect(f); f.connect(g); g.connect(master);
                noise.start();
            }
            else if (p === 4) {
                // Revelation: Major Chord Swell
                // A Major (A, C#, E)
                const chord = [220, 277.18, 329.63, 440, 554.37];
                const g = actx.createGain();
                g.gain.setValueAtTime(0, t);
                g.gain.linearRampToValueAtTime(0.4, t + 2);
                g.connect(master);
                
                chord.forEach(freq => {
                    const o = actx.createOscillator();
                    o.type = 'triangle';
                    o.frequency.value = freq;
                    o.connect(g);
                    o.start();
                });
                
                // Silence Heart
                heartGain.gain.linearRampToValueAtTime(0, t + 2);
            }
            else if (p === 5) {
                // Dissolution: Fade all
                master.gain.linearRampToValueAtTime(0, t + 10);
            }
        }

        function beginJourney() {
            ui.style.opacity = 0;
            status.style.opacity = 1;
            setTimeout(() => ui.style.display = 'none', 3000);
            
            initText();
            initAudio();
            if (actx.state === 'suspended') actx.resume();
            
            isRunning = true;
            changePhase(1);
            render();
        }

    </script>
</body>
</html>