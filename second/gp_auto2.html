<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Autology: The Self-Driving Soul</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,500;1,400&family=Montserrat:wght@200;400&display=swap');

    body {
        margin: 0;
        overflow: hidden;
        background: #020204;
        font-family: 'Cormorant Garamond', serif;
        color: #ddd;
    }

    #ui {
        position: absolute;
        top: 40px;
        left: 40px;
        pointer-events: none;
        width: 350px;
    }

    h1 {
        font-weight: 300;
        font-size: 32px;
        color: #fff;
        margin: 0 0 5px 0;
        letter-spacing: 0.05em;
        text-shadow: 0 0 20px rgba(255,255,255,0.1);
    }
    
    .chapter-display {
        font-family: 'Montserrat', sans-serif;
        font-size: 10px;
        color: #666;
        margin-bottom: 30px;
        text-transform: uppercase;
        letter-spacing: 0.2em;
        border-left: 2px solid #333;
        padding-left: 10px;
    }

    .active-chapter { color: #00d4aa; border-left-color: #00d4aa; }

    .stat-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
        font-size: 16px;
        opacity: 0.7;
    }
    
    .val { font-family: 'Montserrat', monospace; font-size: 12px; font-weight: 400; }
    
    #readout {
        position: absolute;
        bottom: 80px;
        width: 100%;
        text-align: center;
        font-size: 28px;
        font-style: italic;
        opacity: 0.9;
        pointer-events: none;
        transition: color 0.5s, text-shadow 0.5s;
    }

    #annotation {
        position: absolute;
        bottom: 50px;
        width: 100%;
        text-align: center;
        font-family: 'Montserrat', sans-serif;
        font-size: 10px;
        letter-spacing: 0.1em;
        opacity: 0.5;
        text-transform: uppercase;
    }

    .stress-low { color: #00d4aa; text-shadow: 0 0 15px rgba(0,212,170,0.5); }
    .stress-med { color: #ffaa00; text-shadow: 0 0 15px rgba(255,170,0,0.5); }
    .stress-high { color: #ff4466; text-shadow: 0 0 25px rgba(255,68,102,0.6); }
    .stress-break { color: #fff; text-shadow: 0 0 40px rgba(255,255,255,0.8); letter-spacing: 0.3em; }

</style>
</head>
<body>

<div id="ui">
    <h1>The Autology</h1>
    <div id="chapter-box" class="chapter-display">
        SEQUENCE INITIALIZED
    </div>
    
    <div class="stat-row"><span class="label">Structure (P₀)</span><span class="val" id="val-p0">INTACT</span></div>
    <div class="stat-row"><span class="label">Equation (Fₙ)</span><span class="val" id="val-fn">CALCULATING</span></div>
    <div class="stat-row"><span class="label">Memory (k)</span><span class="val" id="val-k">0.00</span></div>
    <div class="stat-row"><span class="label">Pressure (m)</span><span class="val" id="val-m">0.00</span></div>
</div>

<div id="readout" class="stress-low">...</div>
<div id="annotation">OBSERVING SYSTEM DYNAMICS</div>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let width, height;
let time = 0;
let sceneTime = 0;

// THE GHOST (The Automated Mouse)
let target = { x: window.innerWidth/2, y: window.innerHeight/2 };
let targetVel = { x: 0, y: 0 };

// --- PHYSICS CONFIG ---
const RADIUS = 70;
const NODES = 28;
const BASE_K = 0.92; 
const BASE_M = 0.05; 

// --- NARRATIVE ENGINE ---
const SCENES = [
    { duration: 300, title: "I. THE BREATH (Stasis)", subtitle: "Low entropy. System establishes identity." },
    { duration: 500, title: "II. THE DANCE (Flow)", subtitle: "Sine wave motion. Harmony between Inertia and Signal." },
    { duration: 400, title: "III. THE TENSION (Strain)", subtitle: "Acceleration spikes. Viscosity (k) rises to resist deformation." },
    { duration: 350, title: "IV. THE PANIC (Trauma)", subtitle: "Noise injection. Signal clarity is lost. System stiffens." },
    { duration: 250, title: "V. THE TEAR (Dissolution)", subtitle: "Teleportation. Physics breakdown. P₀ Failure." },
    { duration: 400, title: "VI. THE RECOVERY (Grace)", subtitle: "Stillness. Re-integration of the Self." }
];
let sceneIndex = 0;

class Node {
    constructor(angle, center) {
        this.angleOffset = angle;
        this.idealRelX = Math.cos(angle) * RADIUS;
        this.idealRelY = Math.sin(angle) * RADIUS;
        this.pos = { x: center.x + this.idealRelX, y: center.y + this.idealRelY };
        this.vel = { x: 0, y: 0 };
        this.k = BASE_K;
        this.m = BASE_M;
        this.stress = 0;
    }

    update(centerX, centerY, targetVel) {
        // Ideal Position (P0)
        let P0x = centerX + this.idealRelX;
        let P0y = centerY + this.idealRelY;
        
        // Signal Vector (T)
        let Tx = P0x - this.pos.x;
        let Ty = P0y - this.pos.y;
        
        // Reflection/Entropy (R)
        // Increases drastically with scene intensity
        let chaos = 0;
        if (sceneIndex === 3) chaos = 8; // Panic
        if (sceneIndex === 4) chaos = 20; // Tear
        
        let Rx = (Math.random() - 0.5) * chaos;
        let Ry = (Math.random() - 0.5) * chaos;

        // DDA LOGIC
        this.stress = Math.sqrt(Tx*Tx + Ty*Ty);

        if (this.stress < 15) {
            this.k = 0.85; this.m = 0.15; // Soft
        } else if (this.stress < 50) {
            this.k = 0.96; this.m = 0.40; // Hard/Brittle
        } else {
            this.k = 0.60; this.m = 0.02; // Broken
        }

        // F_n = k*F_n-1 + m(T + R)
        let Fx = this.vel.x * this.k + (Tx + Rx) * this.m;
        let Fy = this.vel.y * this.k + (Ty + Ry) * this.m;
        
        this.vel.x = Fx;
        this.vel.y = Fy;
        this.pos.x += this.vel.x;
        this.pos.y += this.vel.y;
    }
}

class Organism {
    constructor() {
        this.center = { x: window.innerWidth/2, y: window.innerHeight/2 };
        this.vel = { x: 0, y: 0 };
        this.nodes = [];
        for (let i = 0; i < NODES; i++) {
            this.nodes.push(new Node((i / NODES) * Math.PI * 2, this.center));
        }
    }

    update() {
        // The Center follows the Ghost Target
        let dx = target.x - this.center.x;
        let dy = target.y - this.center.y;
        
        // The "Will" of the organism to follow
        this.vel.x = dx * 0.05;
        this.vel.y = dy * 0.05;
        this.center.x += this.vel.x;
        this.center.y += this.vel.y;

        let totalStress = 0;
        let maxK = 0;

        this.nodes.forEach(node => {
            node.update(this.center.x, this.center.y, this.vel);
            totalStress += node.stress;
            if(node.k > maxK) maxK = node.k;
        });

        this.avgStress = totalStress / NODES;
        this.maxRigidity = maxK;
        this.updateUI();
    }

    updateUI() {
        // UI Updates
        document.getElementById('val-m').innerText = (this.avgStress/100).toFixed(3);
        document.getElementById('val-k').innerText = this.maxRigidity.toFixed(2);
        
        let p0El = document.getElementById('val-p0');
        let fnEl = document.getElementById('val-fn');
        
        let readout = document.getElementById('readout');

        if (this.avgStress < 15) {
            readout.className = 'stress-low';
            readout.innerText = '"I am whole."';
            p0El.innerText = "STABLE"; p0El.style.color = "#00d4aa";
            fnEl.innerText = "FLOW STATE"; fnEl.style.color = "#00d4aa";
        } else if (this.avgStress < 45) {
            readout.className = 'stress-med';
            readout.innerText = '"I stiffen to hold on."';
            p0El.innerText = "DISTORTED"; p0El.style.color = "#ffaa00";
            fnEl.innerText = "ADAPTING"; fnEl.style.color = "#ffaa00";
        } else if (this.avgStress < 80) {
            readout.className = 'stress-high';
            readout.innerText = '"Too much. Too fast."';
            p0El.innerText = "FRACTURING"; p0El.style.color = "#ff4466";
            fnEl.innerText = "TRAUMA RESPONSE"; fnEl.style.color = "#ff4466";
        } else {
            readout.className = 'stress-break';
            readout.innerText = 'D I S S O L U T I O N';
            p0El.innerText = "LOST"; p0El.style.color = "#fff";
            fnEl.innerText = "SYSTEM FAILURE"; fnEl.style.color = "#fff";
        }
    }

    draw() {
        // Draw Skeleton (Stress)
        if (this.avgStress > 20) {
            ctx.beginPath();
            this.nodes.forEach(n => {
                ctx.moveTo(this.center.x, this.center.y);
                ctx.lineTo(n.pos.x, n.pos.y);
            });
            ctx.strokeStyle = `rgba(255, 68, 102, ${Math.min(1, (this.avgStress-20)/80)})`;
            ctx.stroke();
        }

        // Draw Skin
        ctx.beginPath();
        let first = this.nodes[0];
        let last = this.nodes[NODES-1];
        ctx.moveTo((first.pos.x + last.pos.x)/2, (first.pos.y + last.pos.y)/2);
        
        for (let i = 0; i < NODES; i++) {
            let n1 = this.nodes[i];
            let n2 = this.nodes[(i + 1) % NODES];
            ctx.quadraticCurveTo(n1.pos.x, n1.pos.y, (n1.pos.x + n2.pos.x)/2, (n1.pos.y + n2.pos.y)/2);
        }
        ctx.closePath();

        let r, g, b;
        // Color interpolation based on stress
        if (this.avgStress < 20) { r=0; g=212; b=170; }
        else if (this.avgStress < 60) { r=255; g=170; b=0; }
        else { r=255; g=68; b=102; if (this.avgStress > 90 && Math.random()>0.7) { r=255;g=255;b=255; } }

        ctx.strokeStyle = `rgb(${r},${g},${b})`;
        ctx.lineWidth = 2;
        ctx.fillStyle = `rgba(${r},${g},${b}, 0.1)`;
        ctx.shadowBlur = 20 + this.avgStress;
        ctx.shadowColor = ctx.strokeStyle;
        
        ctx.fill();
        ctx.stroke();
        ctx.shadowBlur = 0;
    }
}

// --- AUTOMATION ENGINE ---
function updateTarget() {
    sceneTime++;
    let t = sceneTime;
    let cx = width/2;
    let cy = height/2;
    
    // Check Scene Transition
    if (sceneTime > SCENES[sceneIndex].duration) {
        sceneIndex = (sceneIndex + 1) % SCENES.length;
        sceneTime = 0;
        t = 0;
        
        // Update Narrative UI
        let scene = SCENES[sceneIndex];
        let box = document.getElementById('chapter-box');
        box.innerText = scene.title;
        box.classList.add('active-chapter');
        setTimeout(() => box.classList.remove('active-chapter'), 500);
        document.getElementById('annotation').innerText = scene.subtitle;
    }

    // CHOREOGRAPHY
    switch(sceneIndex) {
        case 0: // BREATH
            target.x = cx + Math.sin(t*0.05) * 20;
            target.y = cy + Math.cos(t*0.05) * 20;
            break;
        case 1: // DANCE (Figure 8)
            target.x = cx + Math.sin(t*0.04) * 300;
            target.y = cy + Math.sin(t*0.08) * 150;
            break;
        case 2: // TENSION (Erratic Lissajous)
            target.x = cx + Math.sin(t*0.1) * 400;
            target.y = cy + Math.cos(t*0.13) * 300;
            break;
        case 3: // PANIC (Jitter)
            target.x = cx + (Math.random()-0.5) * 600;
            target.y = cy + (Math.random()-0.5) * 600;
            break;
        case 4: // TEAR (Teleport)
            if (t % 40 === 0) {
                target.x = Math.random() * width;
                target.y = Math.random() * height;
            }
            break;
        case 5: // RECOVERY
            target.x += (cx - target.x) * 0.05;
            target.y += (cy - target.y) * 0.05;
            break;
    }
}

let organism;

function init() {
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
    organism = new Organism();
}

function loop() {
    // Fade trail
    ctx.fillStyle = 'rgba(2, 2, 4, 0.2)';
    ctx.fillRect(0, 0, width, height);

    updateTarget();
    organism.update();
    organism.draw();

    // Draw Ghost Target (The Influence)
    ctx.beginPath();
    ctx.arc(target.x, target.y, 6, 0, Math.PI*2);
    ctx.fillStyle = "#fff";
    ctx.fill();
    
    // Draw Tether
    ctx.beginPath();
    ctx.moveTo(organism.center.x, organism.center.y);
    ctx.lineTo(target.x, target.y);
    ctx.strokeStyle = "rgba(255,255,255,0.05)";
    ctx.stroke();

    requestAnimationFrame(loop);
}

window.addEventListener('resize', init);
init();
loop();
</script>
</body>
</html>