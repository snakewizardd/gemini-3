<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halsey - Without Me (Interactive Tab)</title>
    <style>
        :root {
            --primary: #f0d58b; /* Gold */
            --secondary: #ff4d4d; /* Red/Pink accent */
            --bg: #080808;
            --text-dim: #555;
        }

        body {
            margin: 0;
            overflow: hidden;
            background-color: var(--bg);
            font-family: 'Courier New', Courier, monospace;
            color: var(--primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            user-select: none;
        }

        /* Canvas for Visuals */
        #stage {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* UI Overlay */
        #ui-layer {
            position: absolute;
            z-index: 10;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            pointer-events: none; /* Let clicks pass to controls */
            background: radial-gradient(circle, transparent 0%, rgba(0,0,0,0.8) 100%);
        }

        /* Lyrics Display */
        #lyrics-box {
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            perspective: 500px;
            margin-bottom: 50px;
        }

        .lyric-line {
            font-size: 2rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            opacity: 0;
            transform: translateZ(-20px) rotateX(20deg);
            transition: all 0.5s cubic-bezier(0.215, 0.610, 0.355, 1.000);
            text-shadow: 0 0 10px rgba(240, 213, 139, 0.3);
        }

        .lyric-line.active {
            opacity: 1;
            transform: translateZ(0) rotateX(0deg);
        }

        /* Tab Display (Background aesthetic) */
        #tab-scroller {
            position: absolute;
            bottom: 20px;
            right: 20px;
            font-size: 10px;
            color: var(--text-dim);
            white-space: pre;
            opacity: 0.3;
            text-align: right;
        }

        /* Start Button */
        #controls {
            pointer-events: auto;
            z-index: 20;
        }

        button {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            padding: 15px 40px;
            font-size: 1.2rem;
            font-family: inherit;
            cursor: pointer;
            transition: 0.3s;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        button:hover {
            background: var(--primary);
            color: var(--bg);
            box-shadow: 0 0 30px var(--primary);
        }

        /* Animation classes */
        .kick-active {
            animation: shake 0.1s ease-in-out;
        }

        @keyframes shake {
            0% { transform: translate(0, 0); }
            25% { transform: translate(2px, 2px); }
            50% { transform: translate(-2px, -2px); }
            75% { transform: translate(2px, -2px); }
            100% { transform: translate(0, 0); }
        }
    </style>
</head>
<body>

    <canvas id="stage"></canvas>

    <div id="ui-layer">
        <div id="lyrics-box">
            <div id="lyric-text" class="lyric-line">HALSEY - WITHOUT ME</div>
        </div>

        <div id="controls">
            <button id="play-btn">Play Song</button>
        </div>
        
        <div id="tab-scroller">
            Tuning: Standard | Capo: 4th
            [Generative Audio Engine Loaded]
        </div>
    </div>

<script>
/**
 * AUDIO ENGINE
 * Synthesizes guitar, bass, and drums using Web Audio API
 * No external MP3s required.
 */

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let masterGain;
let reverbNode;

// Frequencies for Capo 4 (Standard Tuning relative to Capo)
// Strings: 0=LowE, 1=A, 2=D, 3=G, 4=B, 5=HighE
// Real pitches: G#2, C#3, F#3, B3, D#4, G#4
const BASE_FREQS = [103.83, 138.59, 185.00, 246.94, 311.13, 415.30];

function initAudio() {
    masterGain = audioCtx.createGain();
    masterGain.gain.value = 0.4;
    
    // Simple Convolution Reverb for atmosphere
    reverbNode = audioCtx.createConvolver();
    const rate = audioCtx.sampleRate;
    const length = rate * 2.5; // 2.5s tail
    const impulse = audioCtx.createBuffer(2, length, rate);
    for (let c = 0; c < 2; c++) {
        const chData = impulse.getChannelData(c);
        for (let i = 0; i < length; i++) {
            chData[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / length, 4);
        }
    }
    reverbNode.buffer = impulse;

    masterGain.connect(audioCtx.destination);
    masterGain.connect(reverbNode);
    reverbNode.connect(audioCtx.destination);
}

// -- INSTRUMENTS --

// Synthesized Guitar String (Pluck)
function playString(stringIndex, fret, velocity = 1.0) {
    if(stringIndex < 0 || stringIndex > 5) return;
    const t = audioCtx.currentTime;
    
    // Calculate frequency: Base * 2^(fret/12)
    const frequency = BASE_FREQS[stringIndex] * Math.pow(2, fret / 12);

    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    const filter = audioCtx.createBiquadFilter();

    // Use Sawtooth for brightness, filtered down for "pluck" feel
    osc.type = 'sawtooth';
    osc.frequency.value = frequency;

    filter.type = 'lowpass';
    filter.frequency.setValueAtTime(4000, t);
    filter.frequency.exponentialRampToValueAtTime(frequency, t + 0.3);

    gain.gain.setValueAtTime(0, t);
    gain.gain.linearRampToValueAtTime(velocity * 0.5, t + 0.01);
    gain.gain.exponentialRampToValueAtTime(0.001, t + 2.0); // Decay

    osc.connect(filter);
    filter.connect(gain);
    gain.connect(masterGain);

    osc.start(t);
    osc.stop(t + 2.5);

    // Visual trigger
    visuals.pluck(stringIndex, velocity);
}

// Simple Bass (Sine + Triangle)
function playBass(midiNote, duration) {
    const t = audioCtx.currentTime;
    const freq = 440 * Math.pow(2, (midiNote - 69) / 12);
    
    const osc = audioCtx.createOscillator();
    osc.type = 'triangle';
    osc.frequency.value = freq;
    
    const sub = audioCtx.createOscillator();
    sub.type = 'sine';
    sub.frequency.value = freq / 2;

    const gain = audioCtx.createGain();
    gain.gain.setValueAtTime(0, t);
    gain.gain.linearRampToValueAtTime(0.6, t + 0.05);
    gain.gain.setValueAtTime(0.6, t + duration - 0.1);
    gain.gain.linearRampToValueAtTime(0, t + duration);

    osc.connect(gain);
    sub.connect(gain);
    gain.connect(masterGain);

    osc.start(t);
    sub.start(t);
    osc.stop(t + duration);
    
    visuals.pulseBg();
}

// Drums
function playKick() {
    const t = audioCtx.currentTime;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();

    osc.frequency.setValueAtTime(150, t);
    osc.frequency.exponentialRampToValueAtTime(0.01, t + 0.5);
    
    gain.gain.setValueAtTime(1, t);
    gain.gain.exponentialRampToValueAtTime(0.001, t + 0.5);

    osc.connect(gain);
    gain.connect(masterGain);
    
    osc.start(t);
    osc.stop(t + 0.5);
    
    document.body.classList.add('kick-active');
    setTimeout(() => document.body.classList.remove('kick-active'), 100);
}

function playSnare() {
    const t = audioCtx.currentTime;
    const bufferSize = audioCtx.sampleRate * 0.5;
    const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
    const data = buffer.getChannelData(0);
    for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;

    const noise = audioCtx.createBufferSource();
    noise.buffer = buffer;
    const filter = audioCtx.createBiquadFilter();
    filter.type = 'highpass';
    filter.frequency.value = 1000;
    
    const gain = audioCtx.createGain();
    gain.gain.setValueAtTime(0.5, t);
    gain.gain.exponentialRampToValueAtTime(0.001, t + 0.2);

    noise.connect(filter);
    filter.connect(gain);
    gain.connect(masterGain);
    noise.start(t);
}


/**
 * VISUAL ENGINE (Canvas)
 */
const canvas = document.getElementById('stage');
const ctx = canvas.getContext('2d');
const visuals = {
    strings: [],
    width: 0,
    height: 0,
    init() {
        this.resize();
        window.addEventListener('resize', () => this.resize());
        // Init 6 guitar strings
        for(let i=0; i<6; i++) {
            this.strings.push({ y: 0, amp: 0, color: '#444' });
        }
        this.loop();
    },
    resize() {
        this.width = canvas.width = window.innerWidth;
        this.height = canvas.height = window.innerHeight;
        // Spacing for strings
        const spacing = this.height / 8;
        this.strings.forEach((s, i) => s.y = spacing * (i + 1.5));
    },
    pluck(index, force) {
        // Strings in canvas are 0 (top) to 5 (bottom). 
        // Guitar logic 0 is Low E (thick). In tabs, Low E is bottom visually usually, but let's invert for screen.
        // Let's map String 0 (Low E) to Bottom of screen.
        const visualIndex = 5 - index; 
        this.strings[visualIndex].amp = 30 * force;
        this.strings[visualIndex].color = '#f0d58b';
    },
    pulseBg() {
        canvas.style.backgroundColor = '#1a1a1a';
        setTimeout(() => canvas.style.backgroundColor = '#080808', 50);
    },
    loop() {
        ctx.clearRect(0, 0, this.width, this.height);
        
        // Draw strings
        ctx.lineWidth = 3;
        this.strings.forEach((s) => {
            // Physics decay
            s.amp *= 0.9;
            if(Math.abs(s.amp) < 0.1) { s.amp = 0; s.color = '#333'; }
            
            ctx.beginPath();
            ctx.strokeStyle = s.color;
            ctx.shadowBlur = s.amp > 1 ? 15 : 0;
            ctx.shadowColor = s.color;
            
            // Draw sine wave for vibration
            const points = 50;
            for(let i=0; i<=points; i++) {
                const x = (this.width / points) * i;
                // Simple sine vibration based on time and amplitude
                const vib = Math.sin(Date.now() * 0.1 + i) * s.amp * Math.sin((i/points)*Math.PI);
                const y = s.y + vib;
                if(i===0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
        });
        requestAnimationFrame(() => this.loop());
    }
};
visuals.init();


/**
 * SEQUENCER
 * Interprets the Tab logic
 */
const lyricEl = document.getElementById('lyric-text');
const sleep = ms => new Promise(r => setTimeout(r, ms));

// BPM = 136 (ish). Quarter note ~ 441ms.
// The picking pattern is 8th notes.
const EIGHTH = 220; 
const QUARTER = 440;

async function updateLyric(text) {
    lyricEl.classList.remove('active');
    await sleep(200);
    lyricEl.innerText = text;
    lyricEl.classList.add('active');
}

// Patterns based on your Tab
// Bm7: x24232 (Tab: A-2, D-4, G-2, B-3, e-2...0)
const patterns = {
    Bm_Intro: async () => {
        playString(1, 2); await sleep(EIGHTH); // A string 2nd fret
        playString(2, 4); await sleep(EIGHTH); // D string 4th fret
        playString(3, 2); await sleep(EIGHTH); // G string 2nd fret
        playString(4, 3); await sleep(EIGHTH); // B string 3rd fret
        playString(5, 2); await sleep(EIGHTH); // e string 2nd fret
        playString(5, 0); await sleep(EIGHTH*3); // e string 0 (let ring)
    },
    D_Intro: async () => {
        playString(2, 0); await sleep(EIGHTH); // D open
        playString(3, 2); await sleep(EIGHTH); 
        playString(4, 3); await sleep(EIGHTH); 
        playString(5, 0); await sleep(EIGHTH*5);
    },
    A_Intro: async () => {
        playString(1, 0); await sleep(EIGHTH); // A open
        playString(3, 2); await sleep(EIGHTH); 
        playString(4, 2); await sleep(EIGHTH); 
        playString(5, 0); await sleep(EIGHTH);
        playString(4, 3); await sleep(EIGHTH*3); // The '3' in tab on B string
    },
    G_Intro: async () => {
        playString(0, 3); await sleep(EIGHTH); // Low E 3rd fret
        playString(1, 2); await sleep(EIGHTH);
        playString(3, 0); await sleep(EIGHTH);
        playString(4, 0); await sleep(EIGHTH*5);
    },
    // Strum function for Chorus
    strum: async (chordName) => {
        // Simple strum simulation
        if(chordName === 'Bm') { playString(1,2); playString(2,4); playString(3,2); playString(4,3); playString(5,2); }
        if(chordName === 'D')  { playString(2,0); playString(3,2); playString(4,3); playString(5,2); }
        if(chordName === 'A')  { playString(1,0); playString(2,2); playString(3,2); playString(4,2); }
        if(chordName === 'G')  { playString(0,3); playString(1,2); playString(2,0); playString(3,0); playString(4,3); }
        await sleep(QUARTER * 4);
    }
};

async function playSong() {
    document.getElementById('play-btn').style.display = 'none';
    if(audioCtx.state === 'suspended') await audioCtx.resume();
    initAudio();

    // INTRO
    await updateLyric("[Intro]");
    await patterns.Bm_Intro();
    await patterns.D_Intro();
    await patterns.A_Intro();
    await patterns.G_Intro();

    // VERSE 1
    await updateLyric("Found you when your heart was broke");
    playBass(56, QUARTER*4); // G#
    await patterns.Bm_Intro();
    playBass(59, QUARTER*4); // B
    await patterns.D_Intro();

    await updateLyric("I filled your cup until it overflowed");
    playBass(61, QUARTER*4); // C#
    await patterns.A_Intro();
    playBass(52, QUARTER*4); // E (Low)
    await patterns.G_Intro();

    await updateLyric("Took it so far to keep you close");
    playBass(56, QUARTER*4); await patterns.Bm_Intro();
    playBass(59, QUARTER*4); await patterns.D_Intro();

    await updateLyric("I was afraid to leave you on your own");
    playBass(61, QUARTER*4); await patterns.A_Intro();
    playBass(52, QUARTER*4); await patterns.G_Intro();

    // PRE-CHORUS (Add Drums)
    await updateLyric("I said I'd catch you if you fall");
    playKick(); playBass(56, QUARTER*4); await patterns.Bm_Intro();
    playKick(); playBass(59, QUARTER*4); await patterns.D_Intro();

    await updateLyric("And if they laugh, then f*** 'em all");
    playKick(); playSnare(); await patterns.A_Intro();
    playKick(); playSnare(); await patterns.G_Intro();

    await updateLyric("And then I got you off your knees");
    playBass(56, QUARTER*2); playKick(); await sleep(QUARTER); playKick(); await sleep(QUARTER);
    playBass(59, QUARTER*2); playSnare(); await sleep(QUARTER*2);

    await updateLyric("Put you right back on your feet");
    playBass(61, QUARTER*4); playKick(); await sleep(QUARTER); playKick(); await sleep(QUARTER); playSnare(); await sleep(QUARTER);

    await updateLyric("Just so you could take advantage of me");
    // Build up
    playSnare(); await sleep(EIGHTH); playSnare(); await sleep(EIGHTH); 
    playSnare(); await sleep(EIGHTH); playSnare(); await sleep(EIGHTH);
    
    // CHORUS (Heavy)
    const ch = async () => {
        playKick(); playSnare(); 
        await sleep(QUARTER);
        playKick(); 
        await sleep(QUARTER);
    };

    await updateLyric("Tell me, how's it feel sittin' up there?");
    playBass(56, QUARTER*4); patterns.strum('Bm'); await ch(); await ch();

    await updateLyric("Feeling so high, but too far away to hold me");
    playBass(59, QUARTER*4); patterns.strum('D'); await ch(); await ch();

    await updateLyric("You know I'm the one who put you up there");
    playBass(61, QUARTER*4); patterns.strum('A'); await ch(); await ch();

    await updateLyric("Name in the sky, does it ever get lonely?");
    playBass(52, QUARTER*4); patterns.strum('G'); await ch(); await ch();

    await updateLyric("Thinking you could live without me");
    playKick(); playBass(56, QUARTER*4); patterns.strum('Bm'); await sleep(QUARTER*4);
    
    await updateLyric("Thinking you could live without me");
    playBass(61, QUARTER*4); patterns.strum('A'); await sleep(QUARTER*2);
    patterns.strum('G'); await sleep(QUARTER*2);
    
    // Outro fade
    await updateLyric("Without Me.");
    patterns.Bm_Intro();
    await sleep(2000);
    
    document.getElementById('play-btn').style.display = 'block';
    document.getElementById('play-btn').innerText = "Replay";
}

document.getElementById('play-btn').addEventListener('click', playSong);

</script>
</body>
</html>