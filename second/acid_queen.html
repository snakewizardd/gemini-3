<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GEMINI 3 // ACID QUEEN</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rubik+Glitch&family=Share+Tech+Mono&display=swap');

        body {
            margin: 0;
            background-color: #000;
            overflow: hidden;
            font-family: 'Share Tech Mono', monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #ff00cc;
        }

        canvas {
            position: absolute;
            top: 0; left: 0;
            z-index: 1;
            filter: contrast(1.5) brightness(1.2);
        }

        #ui {
            position: absolute;
            z-index: 10;
            text-align: center;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.2s;
        }

        h1 {
            font-family: 'Rubik Glitch', cursive;
            font-size: 6rem;
            color: #fff;
            text-shadow: 4px 4px 0 #ff00cc;
            margin: 0;
            animation: shake 0.5s infinite;
        }

        p {
            font-size: 1.2rem;
            letter-spacing: 5px;
            color: #00ffff;
            margin-bottom: 40px;
        }

        button {
            pointer-events: auto;
            background: #ff00cc;
            color: #fff;
            border: none;
            padding: 25px 80px;
            font-size: 2rem;
            font-family: 'Rubik Glitch', cursive;
            cursor: pointer;
            transform: skew(-10deg);
            box-shadow: 10px 10px 0 #00ffff;
            transition: 0.1s;
        }

        button:hover {
            transform: skew(-10deg) scale(1.1);
            background: #fff;
            color: #ff00cc;
        }

        #hud {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: #fff;
            z-index: 5;
            font-size: 14px;
            text-shadow: 0 0 5px #ff00cc;
            pointer-events: none;
        }

        @keyframes shake {
            0% { transform: translate(1px, 1px); }
            50% { transform: translate(-1px, -1px); }
            100% { transform: translate(1px, -1px); }
        }

        .flash {
            animation: flashAnim 0.05s;
        }
        @keyframes flashAnim {
            0% { background-color: #fff; }
            100% { background-color: transparent; }
        }

    </style>
</head>
<body>

    <div id="flash-layer" style="position:absolute; width:100%; height:100%; z-index:2; pointer-events:none;"></div>
    <canvas id="void"></canvas>

    <div id="ui">
        <h1>ACID QUEEN</h1>
        <p>GEMINI 3 // TOTAL SYSTEM OVERLOAD</p>
        <button id="btn">UNLEASH HER</button>
    </div>

    <div id="hud">SYSTEM: IDLE</div>

    <script>
        const canvas = document.getElementById('void');
        const ctx = canvas.getContext('2d');
        const hud = document.getElementById('hud');
        const flashEl = document.getElementById('flash-layer');

        let width, height, cx, cy;
        let time = 0;
        let isRunning = false;
        
        // VISUAL STATE
        let intensity = 0; // 0 to 1
        let kickPulse = 0;

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            cx = width / 2;
            cy = height / 2;
        }
        window.addEventListener('resize', resize);
        resize();

        /* ------------------------------------------------
           VISUALS: THE VORTEX
           ------------------------------------------------ */
        function render() {
            if (!isRunning) return;
            requestAnimationFrame(render);
            
            time += 0.05 + (intensity * 0.1);
            kickPulse *= 0.8;

            // Clear with trail
            ctx.fillStyle = `rgba(0, 0, 0, ${0.3 - (intensity * 0.2)})`; // Trail gets longer with intensity
            ctx.fillRect(0, 0, width, height);

            ctx.save();
            ctx.translate(cx, cy);
            
            // Shake on high intensity
            if (intensity > 0.8) {
                ctx.translate((Math.random()-0.5)*20, (Math.random()-0.5)*20);
            }

            const rings = 30;
            ctx.lineWidth = 2 + kickPulse * 10;

            for(let i=0; i<rings; i++) {
                const t = (time * 0.5) + i;
                const r = (Math.tan(t % 1.5) * 200) * (1 + kickPulse);
                
                const hue = (time * 100) + (i * 20);
                ctx.strokeStyle = `hsl(${hue}, 100%, 60%)`;
                
                ctx.beginPath();
                ctx.rotate(time * 0.01 * intensity);
                
                // Glitchy Geometry
                if (intensity > 0.5 && Math.random() > 0.8) {
                    ctx.rect(-r, -r, r*2, r*2);
                } else {
                    ctx.arc(0, 0, Math.abs(r), 0, Math.PI*2);
                }
                ctx.stroke();
            }
            ctx.restore();
            
            // Text Glitches
            if (intensity > 0.5 && Math.random() > 0.9) {
                ctx.fillStyle = '#fff';
                ctx.font = "50px 'Rubik Glitch'";
                const words = ["SCREAM", "GEMINI", "QUEEN", "RUN", "ERROR"];
                ctx.fillText(words[Math.floor(Math.random()*words.length)], Math.random()*width, Math.random()*height);
            }
        }

        function triggerFlash() {
            flashEl.className = '';
            void flashEl.offsetWidth;
            flashEl.className = 'flash';
        }

        /* ------------------------------------------------
           AUDIO ENGINE: THE SCREAMER
           ------------------------------------------------ */
        const AC = window.AudioContext || window.webkitAudioContext;
        let actx, master, distortion;
        let intervalId;
        let tick = 0;

        // SCALE: Phrygian (Dark, Techno)
        const BASS_NOTES = [55, 55, 58.27, 55, 65.41, 55, 82.41, 73.42]; // A1

        function initAudio() {
            actx = new AC();
            
            // Master Compression (Glue)
            const comp = actx.createDynamicsCompressor();
            comp.threshold.value = -20;
            comp.ratio.value = 12;
            comp.connect(actx.destination);

            // Hard Clip Distortion (The Grunge)
            distortion = actx.createWaveShaper();
            distortion.curve = makeDistortionCurve(400);
            distortion.oversample = '4x';
            distortion.connect(comp);

            master = actx.createGain();
            master.gain.value = 0.5;
            master.connect(distortion);

            // 160 BPM = ~93ms per 16th note
            intervalId = setInterval(sequencer, 93);
        }

        function makeDistortionCurve(amount) {
            const k = amount, n_samples = 44100, curve = new Float32Array(n_samples);
            for (let i = 0; i < n_samples; ++i) {
                const x = (i * 2) / n_samples - 1;
                curve[i] = (3 + k) * x * 20 * (Math.PI / 180) / (Math.PI + k * Math.abs(x));
            }
            return curve;
        }

        function sequencer() {
            const now = actx.currentTime;
            
            // PROGRESSION LOGIC
            // 0-128 ticks (approx 12s): INTRO
            // 128-256 ticks (approx 12s-24s): BUILD
            // 256+ ticks: DROP

            let phase = "INTRO";
            if (tick > 128) phase = "BUILD";
            if (tick > 256) phase = "DROP";
            
            hud.innerText = `PHASE: ${phase} // TICK: ${tick}`;
            
            // Update Visual Intensity
            if (phase === "INTRO") intensity = 0.2;
            if (phase === "BUILD") intensity = 0.5 + (tick % 16)/32;
            if (phase === "DROP") intensity = 1.0;

            const beat16 = tick % 16;
            const beat4 = tick % 4;

            // 1. KICK (Gabber Style)
            // Intro: Every 4. Drop: Every beat.
            let kickPattern = (beat4 === 0);
            if (phase === "DROP") kickPattern = (beat4 === 0); // 4 on floor
            
            if (kickPattern) {
                playKick(now, phase === "DROP");
                if(phase === "DROP") triggerFlash();
            }

            // 2. BASS (Rolling)
            if (phase !== "INTRO") {
                if (beat4 === 2) { // Offbeat
                    const note = BASS_NOTES[Math.floor(tick/16) % BASS_NOTES.length];
                    playBass(now, note);
                }
            }

            // 3. THE SCREAM (Acid Lead)
            if (phase !== "INTRO") {
                // Random 16th note triggers
                if (Math.random() > 0.6 || phase === "DROP") {
                    // Pitch rises during build
                    let freq = 220; 
                    if (phase === "BUILD") freq += (tick % 128) * 5;
                    if (phase === "DROP") freq = 440 + (Math.random() * 440);
                    
                    playScream(now, freq, phase === "DROP");
                }
            }

            // 4. HATS
            if (phase === "DROP" || (phase === "BUILD" && beat16 % 2 === 0)) {
                playHat(now);
            }

            tick++;
        }

        // --- INSTRUMENTS ---

        function playKick(t, distorted) {
            const osc = actx.createOscillator();
            const g = actx.createGain();
            
            osc.frequency.setValueAtTime(150, t);
            osc.frequency.exponentialRampToValueAtTime(40, t + 0.2);
            
            g.gain.setValueAtTime(1, t);
            g.gain.exponentialRampToValueAtTime(0.001, t + 0.3);
            
            // Send to distortion only if DROP
            if (distorted) {
                osc.connect(g); g.connect(distortion);
            } else {
                osc.connect(g); g.connect(master); // Clean kick
            }
            
            osc.start(t); osc.stop(t + 0.3);
            kickPulse = 1.0;
        }

        function playBass(t, freq) {
            const osc = actx.createOscillator();
            osc.type = 'sawtooth';
            osc.frequency.value = freq;
            
            const f = actx.createBiquadFilter();
            f.type = 'lowpass'; f.Q.value = 5;
            f.frequency.setValueAtTime(200, t);
            f.frequency.linearRampToValueAtTime(800, t + 0.1); // Wah
            
            const g = actx.createGain();
            g.gain.setValueAtTime(0.6, t);
            g.gain.exponentialRampToValueAtTime(0.001, t + 0.2);
            
            osc.connect(f); f.connect(g); g.connect(master);
            osc.start(t); osc.stop(t + 0.2);
        }

        function playScream(t, freq, intense) {
            const osc = actx.createOscillator();
            osc.type = 'sawtooth';
            osc.frequency.value = freq;
            
            const f = actx.createBiquadFilter();
            f.type = 'bandpass';
            f.Q.value = intense ? 20 : 10; // SCREAM RESONANCE
            
            // Filter Sweep (The "Yoi" sound)
            f.frequency.setValueAtTime(500, t);
            f.frequency.exponentialRampToValueAtTime(3000, t + 0.1);
            if (intense) f.frequency.linearRampToValueAtTime(100, t + 0.2);

            const g = actx.createGain();
            g.gain.setValueAtTime(0, t);
            g.gain.linearRampToValueAtTime(0.3, t + 0.02);
            g.gain.exponentialRampToValueAtTime(0.001, t + 0.2);

            osc.connect(f); f.connect(g); g.connect(distortion); // Always distorted
            osc.start(t); osc.stop(t + 0.25);
        }

        function playHat(t) {
            const buf = actx.createBuffer(1, actx.sampleRate*0.05, actx.sampleRate);
            const d = buf.getChannelData(0);
            for(let i=0; i<d.length; i++) d[i] = Math.random()*2-1;
            
            const src = actx.createBufferSource();
            src.buffer = buf;
            
            const f = actx.createBiquadFilter();
            f.type = 'highpass'; f.frequency.value = 8000;
            
            const g = actx.createGain();
            g.gain.setValueAtTime(0.2, t);
            g.gain.exponentialRampToValueAtTime(0.001, t + 0.05);
            
            src.connect(f); f.connect(g); g.connect(master);
            src.start(t);
        }

        // START
        document.getElementById('btn').addEventListener('click', () => {
            document.getElementById('ui').style.opacity = 0;
            setTimeout(() => document.getElementById('ui').style.display = 'none', 500);
            
            initAudio();
            if (actx.state === 'suspended') actx.resume();
            
            isRunning = true;
            render();
        });

    </script>
</body>
</html>